<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | Ouroboros-based implementation of 'Hydra.Network' interface.</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- This implements a dumb 'FireForget' protocol and maintains one connection to each peer.</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- Contrary to other protocols implemented in Ouroboros, this is a push-based protocol.</span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hydra.Network.Ouroboros</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-5"></span><span>  </span><span class="annot"><a href="Hydra.Network.Ouroboros.html#withOuroborosNetwork"><span class="hs-identifier">withOuroborosNetwork</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>  </span><span class="annot"><span class="hs-identifier">withIOManager</span></span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>  </span><span class="annot"><a href="Hydra.Network.Ouroboros.html#TraceOuroborosNetwork"><span class="hs-identifier">TraceOuroborosNetwork</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>  </span><span class="annot"><a href="Hydra.Network.Ouroboros.html#WithHost"><span class="hs-identifier">WithHost</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>  </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Hydra.Network.html"><span class="hs-identifier">Hydra.Network</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>  </span><span class="annot"><a href="Hydra.Network.Ouroboros.html#encodeTraceSendRecvFireForget"><span class="hs-identifier">encodeTraceSendRecvFireForget</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Class.MonadAsync</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">wait</span></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Prelude</span></span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Codec.CBOR.Term</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Term</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Codec.CBOR.Term</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CBOR</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.html"><span class="hs-identifier">Control.Concurrent.STM</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.TChan.html#TChan"><span class="hs-identifier">TChan</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.TChan.html#dupTChan"><span class="hs-identifier">dupTChan</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.TChan.html#newBroadcastTChanIO"><span class="hs-identifier">newBroadcastTChanIO</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.TChan.html#readTChan"><span class="hs-identifier">readTChan</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.TChan.html#writeTChan"><span class="hs-identifier">writeTChan</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Control.Exception.html"><span class="hs-identifier">Control.Exception</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.Exception.html#IOException"><span class="hs-identifier">IOException</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">object</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">withObject</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.:)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.=)</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Aeson</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson.Types</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Aeson</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Strict.html"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Logging.html"><span class="hs-identifier">Hydra.Logging</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Tracer</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">nullTracer</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Network.html"><span class="hs-identifier">Hydra.Network</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><a href="Hydra.Network.html#Host"><span class="hs-identifier">Host</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><a href="Hydra.Network.html#Network"><span class="hs-identifier">Network</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><a href="Hydra.Network.html#NetworkCallback"><span class="hs-identifier">NetworkCallback</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><a href="Hydra.Network.html#NetworkComponent"><span class="hs-identifier">NetworkComponent</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><span class="hs-identifier">PortNumber</span></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Network.Ouroboros.Client.html"><span class="hs-identifier">Hydra.Network.Ouroboros.Client</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FireForget</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-39"></span><span>  </span><span class="annot"><a href="Hydra.Network.Ouroboros.Client.html#FireForgetClient"><span class="hs-identifier">FireForgetClient</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><a href="Hydra.Network.Ouroboros.Client.html#fireForgetClientPeer"><span class="hs-identifier">fireForgetClientPeer</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Network.Ouroboros.Server.html"><span class="hs-identifier">Hydra.Network.Ouroboros.Server</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FireForget</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><a href="Hydra.Network.Ouroboros.Server.html#FireForgetServer"><span class="hs-identifier">FireForgetServer</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><a href="Hydra.Network.Ouroboros.Server.html#fireForgetServerPeer"><span class="hs-identifier">fireForgetServerPeer</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Network.Ouroboros.Type.html"><span class="hs-identifier">Hydra.Network.Ouroboros.Type</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-47"></span><span>  </span><span class="annot"><a href="Hydra.Network.Ouroboros.Type.html#FireForget"><span class="hs-identifier">FireForget</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><span class="hs-identifier">Message</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><a href="Hydra.Network.Ouroboros.Type.html#codecFireForget"><span class="hs-identifier">codecFireForget</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Mux.Compat</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><span class="hs-identifier">WithMuxBearer</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Socket</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-55"></span><span>  </span><span class="annot"><span class="hs-identifier">AddrInfo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">addrAddress</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><span class="hs-identifier">SockAddr</span></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>  </span><span class="annot"><span class="hs-identifier">defaultHints</span></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>  </span><span class="annot"><span class="hs-identifier">getAddrInfo</span></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.TypedProtocol.Codec</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-61"></span><span>  </span><span class="annot"><span class="hs-identifier">AnyMessageAndAgency</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.TypedProtocol.Pipelined</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.Driver.Simple</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><span class="hs-identifier">TraceSendRecv</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.ErrorPolicy</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-68"></span><span>  </span><span class="annot"><span class="hs-identifier">ErrorPolicyTrace</span></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>  </span><span class="annot"><span class="hs-identifier">WithAddr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">WithAddr</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>  </span><span class="annot"><span class="hs-identifier">nullErrorPolicies</span></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.IOManager</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">withIOManager</span></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.Mux</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><span class="hs-identifier">MiniProtocol</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><span class="hs-identifier">MiniProtocol</span></span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><span class="hs-identifier">miniProtocolLimits</span></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><span class="hs-identifier">miniProtocolNum</span></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><span class="hs-identifier">miniProtocolRun</span></span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><span class="hs-identifier">MiniProtocolCb</span></span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span>  </span><span class="annot"><span class="hs-identifier">MiniProtocolLimits</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>  </span><span class="annot"><span class="hs-identifier">MiniProtocolNum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MiniProtocolNum</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-83"></span><span>  </span><span class="annot"><span class="hs-identifier">MuxMode</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-84"></span><span>  </span><span class="annot"><span class="hs-identifier">OuroborosApplication</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>  </span><span class="annot"><span class="hs-identifier">OuroborosApplicationWithMinimalCtx</span></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><span class="hs-identifier">RunMiniProtocol</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>  </span><span class="annot"><span class="hs-identifier">mkMiniProtocolCbFromPeer</span></span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.Protocol.Handshake.Codec</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">noTimeLimitsHandshake</span></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.Protocol.Handshake.Type</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Handshake</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Message</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">RefuseReason</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.Protocol.Handshake.Unversioned</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-92"></span><span>  </span><span class="annot"><span class="hs-identifier">UnversionedProtocol</span></span><span class="hs-special">,</span><span>
</span><span id="line-93"></span><span>  </span><span class="annot"><span class="hs-identifier">unversionedHandshakeCodec</span></span><span class="hs-special">,</span><span>
</span><span id="line-94"></span><span>  </span><span class="annot"><span class="hs-identifier">unversionedProtocol</span></span><span class="hs-special">,</span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><span class="hs-identifier">unversionedProtocolDataCodec</span></span><span class="hs-special">,</span><span>
</span><span id="line-96"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.Protocol.Handshake.Version</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">acceptableVersion</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">queryVersion</span></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.Server.Socket</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">AcceptedConnectionsLimit</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">AcceptedConnectionsLimit</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.Snocket</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">makeSocketBearer</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">socketSnocket</span></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.Socket</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-101"></span><span>  </span><span class="annot"><span class="hs-identifier">AcceptConnectionsPolicyTrace</span></span><span class="hs-special">,</span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><span class="hs-identifier">ConnectionId</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-103"></span><span>  </span><span class="annot"><span class="hs-identifier">HandshakeCallbacks</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-104"></span><span>  </span><span class="annot"><span class="hs-identifier">NetworkConnectTracers</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>  </span><span class="annot"><span class="hs-identifier">NetworkServerTracers</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-106"></span><span>  </span><span class="annot"><span class="hs-identifier">SomeResponderApplication</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-107"></span><span>  </span><span class="annot"><span class="hs-identifier">connectToNodeSocket</span></span><span class="hs-special">,</span><span>
</span><span id="line-108"></span><span>  </span><span class="annot"><span class="hs-identifier">newNetworkMutableState</span></span><span class="hs-special">,</span><span>
</span><span id="line-109"></span><span>  </span><span class="annot"><span class="hs-identifier">withServerNode</span></span><span class="hs-special">,</span><span>
</span><span id="line-110"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.Subscription</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-112"></span><span>  </span><span class="annot"><span class="hs-identifier">IPSubscriptionTarget</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IPSubscriptionTarget</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-113"></span><span>  </span><span class="annot"><span class="hs-identifier">SubscriptionTrace</span></span><span class="hs-special">,</span><span>
</span><span id="line-114"></span><span>  </span><span class="annot"><span class="hs-identifier">WithIPList</span></span><span class="hs-special">,</span><span>
</span><span id="line-115"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.Subscription</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Subscription</span></span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.Subscription.Ip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SubscriptionParams</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">WithIPList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">WithIPList</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ouroboros.Network.Subscription.Worker</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">LocalAddresses</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">LocalAddresses</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="annot"><a href="Hydra.Network.Ouroboros.html#withOuroborosNetwork"><span class="hs-identifier hs-type">withOuroborosNetwork</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680175086"><span class="annot"><a href="#local-6989586621680175086"><span class="hs-identifier hs-type">msg</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ToCBOR</span></span><span> </span><span class="annot"><a href="#local-6989586621680175086"><span class="hs-identifier hs-type">msg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FromCBOR</span></span><span> </span><span class="annot"><a href="#local-6989586621680175086"><span class="hs-identifier hs-type">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-123"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tracer</span></span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Network.Ouroboros.html#WithHost"><span class="hs-identifier hs-type">WithHost</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Network.Ouroboros.html#TraceOuroborosNetwork"><span class="hs-identifier hs-type">TraceOuroborosNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680175086"><span class="hs-identifier hs-type">msg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-124"></span><span>  </span><span class="annot"><a href="Hydra.Network.html#Host"><span class="hs-identifier hs-type">Host</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Hydra.Network.html#Host"><span class="hs-identifier hs-type">Host</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><a href="Hydra.Network.html#NetworkComponent"><span class="hs-identifier hs-type">NetworkComponent</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680175086"><span class="hs-identifier hs-type">msg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680175086"><span class="hs-identifier hs-type">msg</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span id="withOuroborosNetwork"><span class="annot"><span class="annottext">withOuroborosNetwork :: forall msg.
(ToCBOR msg, FromCBOR msg) =&gt;
Tracer IO (WithHost (TraceOuroborosNetwork msg))
-&gt; Host -&gt; [Host] -&gt; NetworkComponent IO msg msg ()
</span><a href="Hydra.Network.Ouroboros.html#withOuroborosNetwork"><span class="hs-identifier hs-var hs-var">withOuroborosNetwork</span></a></span></span><span> </span><span id="local-6989586621680175557"><span class="annot"><span class="annottext">Tracer IO (WithHost (TraceOuroborosNetwork msg))
</span><a href="#local-6989586621680175557"><span class="hs-identifier hs-var">tracer</span></a></span></span><span> </span><span id="local-6989586621680175558"><span class="annot"><span class="annottext">Host
</span><a href="#local-6989586621680175558"><span class="hs-identifier hs-var">localHost</span></a></span></span><span> </span><span id="local-6989586621680175559"><span class="annot"><span class="annottext">[Host]
</span><a href="#local-6989586621680175559"><span class="hs-identifier hs-var">remoteHosts</span></a></span></span><span> </span><span id="local-6989586621680175560"><span class="annot"><span class="annottext">NetworkCallback msg IO
</span><a href="#local-6989586621680175560"><span class="hs-identifier hs-var">networkCallback</span></a></span></span><span> </span><span id="local-6989586621680175561"><span class="annot"><span class="annottext">Network IO msg -&gt; IO ()
</span><a href="#local-6989586621680175561"><span class="hs-identifier hs-var">between</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-128"></span><span>  </span><span id="local-6989586621680175562"><span class="annot"><span class="annottext">TChan msg
</span><a href="#local-6989586621680175562"><span class="hs-identifier hs-var">bchan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (TChan msg)
forall a. IO (TChan a)
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.TChan.html#newBroadcastTChanIO"><span class="hs-identifier hs-var">newBroadcastTChanIO</span></a></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680175563"><span class="annot"><span class="annottext">newBroadcastChannel :: IO (TChan msg)
</span><a href="#local-6989586621680175563"><span class="hs-identifier hs-var hs-var">newBroadcastChannel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM IO (TChan msg) -&gt; IO (TChan msg)
forall a. HasCallStack =&gt; STM IO a -&gt; IO a
forall (m :: * -&gt; *) a.
(MonadSTM m, HasCallStack) =&gt;
STM m a -&gt; m a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM IO (TChan msg) -&gt; IO (TChan msg))
-&gt; STM IO (TChan msg) -&gt; IO (TChan msg)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TChan msg -&gt; STM (TChan msg)
forall a. TChan a -&gt; STM (TChan a)
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.TChan.html#dupTChan"><span class="hs-identifier hs-var">dupTChan</span></a></span><span> </span><span class="annot"><span class="annottext">TChan msg
</span><a href="#local-6989586621680175562"><span class="hs-identifier hs-var">bchan</span></a></span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-comment">-- NOTE: There should only be one `IOManager` instance per process. Should we</span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-comment">-- want to use ouroboros network framework in other places, we must factor out</span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-comment">-- this instantiation</span><span>
</span><span id="line-133"></span><span>  </span><span class="annot"><span class="annottext">(IOManager -&gt; IO ()) -&gt; IO ()
WithIOManager
</span><span class="hs-identifier hs-var">withIOManager</span></span><span> </span><span class="annot"><span class="annottext">((IOManager -&gt; IO ()) -&gt; IO ()) -&gt; (IOManager -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680175565"><span class="annot"><span class="annottext">IOManager
</span><a href="#local-6989586621680175565"><span class="hs-identifier hs-var">iomgr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-134"></span><span>    </span><span class="annot"><span class="annottext">IOManager
-&gt; OuroborosApplicationWithMinimalCtx
     'ResponderMode SockAddr ByteString IO Void ()
-&gt; IO ()
-&gt; IO ()
</span><a href="#local-6989586621680175566"><span class="hs-identifier hs-var">withServerListening</span></a></span><span> </span><span class="annot"><span class="annottext">IOManager
</span><a href="#local-6989586621680175565"><span class="hs-identifier hs-var">iomgr</span></a></span><span> </span><span class="annot"><span class="annottext">OuroborosApplicationWithMinimalCtx
  'ResponderMode SockAddr ByteString IO Void ()
forall addr.
OuroborosApplicationWithMinimalCtx
  'ResponderMode addr ByteString IO Void ()
</span><a href="#local-6989586621680175567"><span class="hs-identifier hs-var">hydraServer</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-135"></span><span>      </span><span class="annot"><span class="annottext">IO Void -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO ()
forall (m :: * -&gt; *) a b. MonadAsync m =&gt; m a -&gt; m b -&gt; m ()
</span><span class="hs-identifier hs-var">race_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOManager
-&gt; IO (TChan msg)
-&gt; (TChan msg
    -&gt; OuroborosApplicationWithMinimalCtx
         'InitiatorMode SockAddr ByteString IO () Void)
-&gt; IO Void
</span><a href="#local-6989586621680175569"><span class="hs-identifier hs-var">connect</span></a></span><span> </span><span class="annot"><span class="annottext">IOManager
</span><a href="#local-6989586621680175565"><span class="hs-identifier hs-var">iomgr</span></a></span><span> </span><span class="annot"><span class="annottext">IO (TChan msg)
</span><a href="#local-6989586621680175563"><span class="hs-identifier hs-var">newBroadcastChannel</span></a></span><span> </span><span class="annot"><span class="annottext">TChan msg
-&gt; OuroborosApplicationWithMinimalCtx
     'InitiatorMode SockAddr ByteString IO () Void
forall addr.
TChan msg
-&gt; OuroborosApplicationWithMinimalCtx
     'InitiatorMode addr ByteString IO () Void
</span><a href="#local-6989586621680175570"><span class="hs-identifier hs-var">hydraClient</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-136"></span><span>        </span><span class="annot"><span class="annottext">Network IO msg -&gt; IO ()
</span><a href="#local-6989586621680175561"><span class="hs-identifier hs-var">between</span></a></span><span> </span><span class="annot"><span class="annottext">(Network IO msg -&gt; IO ()) -&gt; Network IO msg -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-137"></span><span>          </span><span class="annot"><a href="Hydra.Network.html#Network"><span class="hs-identifier hs-type">Network</span></a></span><span>
</span><span id="line-138"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">broadcast :: NetworkCallback msg IO
</span><a href="Hydra.Network.html#broadcast"><span class="hs-identifier hs-var">broadcast</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
STM IO () -&gt; IO ()
forall a. HasCallStack =&gt; STM IO a -&gt; IO a
forall (m :: * -&gt; *) a.
(MonadSTM m, HasCallStack) =&gt;
STM m a -&gt; m a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ()) -&gt; (msg -&gt; STM ()) -&gt; NetworkCallback msg IO
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TChan msg -&gt; msg -&gt; STM ()
forall a. TChan a -&gt; a -&gt; STM ()
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.TChan.html#writeTChan"><span class="hs-identifier hs-var">writeTChan</span></a></span><span> </span><span class="annot"><span class="annottext">TChan msg
</span><a href="#local-6989586621680175562"><span class="hs-identifier hs-var">bchan</span></a></span><span>
</span><span id="line-139"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-140"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-141"></span><span>  </span><span id="local-6989586621680175590"><span class="annot"><span class="annottext">resolveSockAddr :: Host -&gt; IO SockAddr
</span><a href="#local-6989586621680175590"><span class="hs-identifier hs-var hs-var">resolveSockAddr</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Network.html#Host"><span class="hs-identifier hs-type">Host</span></a></span><span class="hs-special">{</span><span id="local-6989586621680175592"><span class="annot"><span class="annottext">Text
hostname :: Text
hostname :: Host -&gt; Text
</span><a href="#local-6989586621680175592"><span class="hs-identifier hs-var hs-var">hostname</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680175594"><span class="annot"><span class="annottext">PortNumber
port :: PortNumber
port :: Host -&gt; PortNumber
</span><a href="#local-6989586621680175594"><span class="hs-identifier hs-var hs-var">port</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-142"></span><span>    </span><span id="local-6989586621680175596"><span class="annot"><span class="annottext">[AddrInfo]
</span><a href="#local-6989586621680175596"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe AddrInfo
-&gt; Maybe ServiceName -&gt; Maybe ServiceName -&gt; IO [AddrInfo]
</span><span class="hs-identifier hs-var">getAddrInfo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddrInfo -&gt; Maybe AddrInfo
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">AddrInfo
</span><span class="hs-identifier hs-var">defaultHints</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServiceName -&gt; Maybe ServiceName
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(ServiceName -&gt; Maybe ServiceName)
-&gt; ServiceName -&gt; Maybe ServiceName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ServiceName
forall a. ToString a =&gt; a -&gt; ServiceName
</span><span class="hs-identifier hs-var">toString</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680175592"><span class="hs-identifier hs-var">hostname</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServiceName -&gt; Maybe ServiceName
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(ServiceName -&gt; Maybe ServiceName)
-&gt; ServiceName -&gt; Maybe ServiceName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PortNumber -&gt; ServiceName
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">PortNumber
</span><a href="#local-6989586621680175594"><span class="hs-identifier hs-var">port</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[AddrInfo]
</span><a href="#local-6989586621680175596"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-144"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680175599"><span class="annot"><span class="annottext">AddrInfo
</span><a href="#local-6989586621680175599"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span class="annot"><span class="annottext">[AddrInfo]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SockAddr -&gt; IO SockAddr
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(SockAddr -&gt; IO SockAddr) -&gt; SockAddr -&gt; IO SockAddr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">AddrInfo -&gt; SockAddr
</span><span class="hs-identifier hs-var">addrAddress</span></span><span> </span><span class="annot"><span class="annottext">AddrInfo
</span><a href="#local-6989586621680175599"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-145"></span><span>      </span><span class="annot"><span class="annottext">[AddrInfo]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO SockAddr
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;getAdrrInfo failed.. do proper error handling&quot;</span></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span>  </span><span id="local-6989586621680175569"><span class="annot"><span class="annottext">connect :: IOManager
-&gt; IO (TChan msg)
-&gt; (TChan msg
    -&gt; OuroborosApplicationWithMinimalCtx
         'InitiatorMode SockAddr ByteString IO () Void)
-&gt; IO Void
</span><a href="#local-6989586621680175569"><span class="hs-identifier hs-var hs-var">connect</span></a></span></span><span> </span><span id="local-6989586621680175601"><span class="annot"><span class="annottext">IOManager
</span><a href="#local-6989586621680175601"><span class="hs-identifier hs-var">iomgr</span></a></span></span><span> </span><span id="local-6989586621680175602"><span class="annot"><span class="annottext">IO (TChan msg)
</span><a href="#local-6989586621680175602"><span class="hs-identifier hs-var">newBroadcastChannel</span></a></span></span><span> </span><span id="local-6989586621680175603"><span class="annot"><span class="annottext">TChan msg
-&gt; OuroborosApplicationWithMinimalCtx
     'InitiatorMode SockAddr ByteString IO () Void
</span><a href="#local-6989586621680175603"><span class="hs-identifier hs-var">app</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-comment">-- REVIEW(SN): move outside to have this information available?</span><span>
</span><span id="line-149"></span><span>    </span><span id="local-6989586621680175604"><span class="annot"><span class="annottext">NetworkMutableState SockAddr
</span><a href="#local-6989586621680175604"><span class="hs-identifier hs-var">networkState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (NetworkMutableState SockAddr)
forall addr. IO (NetworkMutableState addr)
</span><span class="hs-identifier hs-var">newNetworkMutableState</span></span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-comment">-- Using port number 0 to let the operating system pick a random port</span><span>
</span><span id="line-151"></span><span>    </span><span id="local-6989586621680175605"><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621680175605"><span class="hs-identifier hs-var">localAddr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Host -&gt; IO SockAddr
</span><a href="#local-6989586621680175590"><span class="hs-identifier hs-var">resolveSockAddr</span></a></span><span> </span><span class="annot"><span class="annottext">Host
</span><a href="#local-6989586621680175558"><span class="hs-identifier hs-var">localHost</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Hydra.Network.html#port"><span class="hs-identifier hs-var">port</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">}</span><span>
</span><span id="line-152"></span><span>    </span><span id="local-6989586621680175606"><span class="annot"><span class="annottext">[SockAddr]
</span><a href="#local-6989586621680175606"><span class="hs-identifier hs-var">remoteAddrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Host] -&gt; (Host -&gt; IO SockAddr) -&gt; IO [SockAddr]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Traversable.html#forM"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="annot"><span class="annottext">[Host]
</span><a href="#local-6989586621680175559"><span class="hs-identifier hs-var">remoteHosts</span></a></span><span> </span><span class="annot"><span class="annottext">Host -&gt; IO SockAddr
</span><a href="#local-6989586621680175590"><span class="hs-identifier hs-var">resolveSockAddr</span></a></span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680175608"><span class="annot"><span class="annottext">sn :: SocketSnocket
</span><a href="#local-6989586621680175608"><span class="hs-identifier hs-var hs-var">sn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IOManager -&gt; SocketSnocket
</span><span class="hs-identifier hs-var">socketSnocket</span></span><span> </span><span class="annot"><span class="annottext">IOManager
</span><a href="#local-6989586621680175601"><span class="hs-identifier hs-var">iomgr</span></a></span><span>
</span><span id="line-154"></span><span>    </span><span class="annot"><span class="annottext">SocketSnocket
-&gt; Tracer IO (WithIPList (SubscriptionTrace SockAddr))
-&gt; Tracer IO (WithAddr SockAddr ErrorPolicyTrace)
-&gt; NetworkMutableState SockAddr
-&gt; IPSubscriptionParams ()
-&gt; (Socket -&gt; IO ())
-&gt; IO Void
forall a.
SocketSnocket
-&gt; Tracer IO (WithIPList (SubscriptionTrace SockAddr))
-&gt; Tracer IO (WithAddr SockAddr ErrorPolicyTrace)
-&gt; NetworkMutableState SockAddr
-&gt; IPSubscriptionParams a
-&gt; (Socket -&gt; IO a)
-&gt; IO Void
</span><span class="hs-identifier hs-var">Subscription.ipSubscriptionWorker</span></span><span>
</span><span id="line-155"></span><span>      </span><span class="annot"><span class="annottext">SocketSnocket
</span><a href="#local-6989586621680175608"><span class="hs-identifier hs-var">sn</span></a></span><span>
</span><span id="line-156"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(WithIPList (SubscriptionTrace SockAddr)
 -&gt; WithHost (TraceOuroborosNetwork msg))
-&gt; Tracer IO (WithHost (TraceOuroborosNetwork msg))
-&gt; Tracer IO (WithIPList (SubscriptionTrace SockAddr))
forall a' a. (a' -&gt; a) -&gt; Tracer IO a -&gt; Tracer IO a'
forall (f :: * -&gt; *) a' a.
Contravariant f =&gt;
(a' -&gt; a) -&gt; f a -&gt; f a'
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.Contravariant.html#contramap"><span class="hs-identifier hs-var">contramap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Host
-&gt; TraceOuroborosNetwork msg
-&gt; WithHost (TraceOuroborosNetwork msg)
forall trace. Host -&gt; trace -&gt; WithHost trace
</span><a href="Hydra.Network.Ouroboros.html#WithHost"><span class="hs-identifier hs-var">WithHost</span></a></span><span> </span><span class="annot"><span class="annottext">Host
</span><a href="#local-6989586621680175558"><span class="hs-identifier hs-var">localHost</span></a></span><span> </span><span class="annot"><span class="annottext">(TraceOuroborosNetwork msg -&gt; WithHost (TraceOuroborosNetwork msg))
-&gt; (WithIPList (SubscriptionTrace SockAddr)
    -&gt; TraceOuroborosNetwork msg)
-&gt; WithIPList (SubscriptionTrace SockAddr)
-&gt; WithHost (TraceOuroborosNetwork msg)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">WithIPList (SubscriptionTrace SockAddr)
-&gt; TraceOuroborosNetwork msg
forall {k} (msg :: k).
WithIPList (SubscriptionTrace SockAddr)
-&gt; TraceOuroborosNetwork msg
</span><a href="Hydra.Network.Ouroboros.html#TraceSubscriptions"><span class="hs-identifier hs-var">TraceSubscriptions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tracer IO (WithHost (TraceOuroborosNetwork msg))
</span><a href="#local-6989586621680175557"><span class="hs-identifier hs-var">tracer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(WithAddr SockAddr ErrorPolicyTrace
 -&gt; WithHost (TraceOuroborosNetwork msg))
-&gt; Tracer IO (WithHost (TraceOuroborosNetwork msg))
-&gt; Tracer IO (WithAddr SockAddr ErrorPolicyTrace)
forall a' a. (a' -&gt; a) -&gt; Tracer IO a -&gt; Tracer IO a'
forall (f :: * -&gt; *) a' a.
Contravariant f =&gt;
(a' -&gt; a) -&gt; f a -&gt; f a'
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.Contravariant.html#contramap"><span class="hs-identifier hs-var">contramap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Host
-&gt; TraceOuroborosNetwork msg
-&gt; WithHost (TraceOuroborosNetwork msg)
forall trace. Host -&gt; trace -&gt; WithHost trace
</span><a href="Hydra.Network.Ouroboros.html#WithHost"><span class="hs-identifier hs-var">WithHost</span></a></span><span> </span><span class="annot"><span class="annottext">Host
</span><a href="#local-6989586621680175558"><span class="hs-identifier hs-var">localHost</span></a></span><span> </span><span class="annot"><span class="annottext">(TraceOuroborosNetwork msg -&gt; WithHost (TraceOuroborosNetwork msg))
-&gt; (WithAddr SockAddr ErrorPolicyTrace
    -&gt; TraceOuroborosNetwork msg)
-&gt; WithAddr SockAddr ErrorPolicyTrace
-&gt; WithHost (TraceOuroborosNetwork msg)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">WithAddr SockAddr ErrorPolicyTrace -&gt; TraceOuroborosNetwork msg
forall {k} (msg :: k).
WithAddr SockAddr ErrorPolicyTrace -&gt; TraceOuroborosNetwork msg
</span><a href="Hydra.Network.Ouroboros.html#TraceErrorPolicy"><span class="hs-identifier hs-var">TraceErrorPolicy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tracer IO (WithHost (TraceOuroborosNetwork msg))
</span><a href="#local-6989586621680175557"><span class="hs-identifier hs-var">tracer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>      </span><span class="annot"><span class="annottext">NetworkMutableState SockAddr
</span><a href="#local-6989586621680175604"><span class="hs-identifier hs-var">networkState</span></a></span><span>
</span><span id="line-159"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SockAddr -&gt; [SockAddr] -&gt; IPSubscriptionParams ()
forall {a}.
SockAddr -&gt; [SockAddr] -&gt; SubscriptionParams a IPSubscriptionTarget
</span><a href="#local-6989586621680175614"><span class="hs-identifier hs-var">subscriptionParams</span></a></span><span> </span><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621680175605"><span class="hs-identifier hs-var">localAddr</span></a></span><span> </span><span class="annot"><span class="annottext">[SockAddr]
</span><a href="#local-6989586621680175606"><span class="hs-identifier hs-var">remoteAddrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOManager
-&gt; IO (TChan msg)
-&gt; (TChan msg
    -&gt; OuroborosApplicationWithMinimalCtx
         'InitiatorMode SockAddr ByteString IO () Void)
-&gt; Socket
-&gt; IO ()
forall {appType :: MuxMode} {t} {a} {b}.
(HasInitiator appType ~ 'True) =&gt;
IOManager
-&gt; IO t
-&gt; (t
    -&gt; OuroborosApplicationWithMinimalCtx
         appType SockAddr ByteString IO a b)
-&gt; Socket
-&gt; IO ()
</span><a href="#local-6989586621680175615"><span class="hs-identifier hs-var">actualConnect</span></a></span><span> </span><span class="annot"><span class="annottext">IOManager
</span><a href="#local-6989586621680175601"><span class="hs-identifier hs-var">iomgr</span></a></span><span> </span><span class="annot"><span class="annottext">IO (TChan msg)
</span><a href="#local-6989586621680175602"><span class="hs-identifier hs-var">newBroadcastChannel</span></a></span><span> </span><span class="annot"><span class="annottext">TChan msg
-&gt; OuroborosApplicationWithMinimalCtx
     'InitiatorMode SockAddr ByteString IO () Void
</span><a href="#local-6989586621680175603"><span class="hs-identifier hs-var">app</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span>  </span><span id="local-6989586621680175614"><span class="annot"><span class="annottext">subscriptionParams :: SockAddr -&gt; [SockAddr] -&gt; SubscriptionParams a IPSubscriptionTarget
</span><a href="#local-6989586621680175614"><span class="hs-identifier hs-var hs-var">subscriptionParams</span></a></span></span><span> </span><span id="local-6989586621680175618"><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621680175618"><span class="hs-identifier hs-var">localAddr</span></a></span></span><span> </span><span id="local-6989586621680175619"><span class="annot"><span class="annottext">[SockAddr]
</span><a href="#local-6989586621680175619"><span class="hs-identifier hs-var">remoteAddrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">SubscriptionParams</span></span><span>
</span><span id="line-164"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">spLocalAddresses :: LocalAddresses SockAddr
</span><a href="#local-6989586621680175621"><span class="hs-identifier hs-var">spLocalAddresses</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SockAddr
-&gt; Maybe SockAddr -&gt; Maybe SockAddr -&gt; LocalAddresses SockAddr
forall addr.
Maybe addr -&gt; Maybe addr -&gt; Maybe addr -&gt; LocalAddresses addr
</span><span class="hs-identifier hs-var">LocalAddresses</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SockAddr -&gt; Maybe SockAddr
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621680175618"><span class="hs-identifier hs-var">localAddr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe SockAddr
forall a. Maybe a
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SockAddr
forall a. Maybe a
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-165"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">spConnectionAttemptDelay :: SockAddr -&gt; Maybe DiffTime
</span><a href="#local-6989586621680175622"><span class="hs-identifier hs-var">spConnectionAttemptDelay</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe DiffTime -&gt; SockAddr -&gt; Maybe DiffTime
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DiffTime
forall a. Maybe a
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-166"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">spErrorPolicies :: ErrorPolicies
</span><a href="#local-6989586621680175624"><span class="hs-identifier hs-var">spErrorPolicies</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ErrorPolicies
</span><span class="hs-identifier hs-var">nullErrorPolicies</span></span><span>
</span><span id="line-167"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">spSubscriptionTarget :: IPSubscriptionTarget
</span><a href="#local-6989586621680175625"><span class="hs-identifier hs-var">spSubscriptionTarget</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SockAddr] -&gt; Int -&gt; IPSubscriptionTarget
</span><span class="hs-identifier hs-var">IPSubscriptionTarget</span></span><span> </span><span class="annot"><span class="annottext">[SockAddr]
</span><a href="#local-6989586621680175619"><span class="hs-identifier hs-var">remoteAddrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SockAddr] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[SockAddr]
</span><a href="#local-6989586621680175619"><span class="hs-identifier hs-var">remoteAddrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span>  </span><span id="local-6989586621680175615"><span class="annot"><span class="annottext">actualConnect :: IOManager
-&gt; IO t
-&gt; (t
    -&gt; OuroborosApplicationWithMinimalCtx
         appType SockAddr ByteString IO a b)
-&gt; Socket
-&gt; IO ()
</span><a href="#local-6989586621680175615"><span class="hs-identifier hs-var hs-var">actualConnect</span></a></span></span><span> </span><span id="local-6989586621680175637"><span class="annot"><span class="annottext">IOManager
</span><a href="#local-6989586621680175637"><span class="hs-identifier hs-var">iomgr</span></a></span></span><span> </span><span id="local-6989586621680175638"><span class="annot"><span class="annottext">IO t
</span><a href="#local-6989586621680175638"><span class="hs-identifier hs-var">newBroadcastChannel</span></a></span></span><span> </span><span id="local-6989586621680175639"><span class="annot"><span class="annottext">t
-&gt; OuroborosApplicationWithMinimalCtx
     appType SockAddr ByteString IO a b
</span><a href="#local-6989586621680175639"><span class="hs-identifier hs-var">app</span></a></span></span><span> </span><span id="local-6989586621680175640"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621680175640"><span class="hs-identifier hs-var">sn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-171"></span><span>    </span><span id="local-6989586621680175641"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680175641"><span class="hs-identifier hs-var">chan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO t
</span><a href="#local-6989586621680175638"><span class="hs-identifier hs-var">newBroadcastChannel</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="annot"><span class="annottext">IOManager
-&gt; Codec
     (Handshake UnversionedProtocol Term)
     DeserialiseFailure
     IO
     ByteString
-&gt; ProtocolTimeLimits (Handshake UnversionedProtocol Term)
-&gt; VersionDataCodec
     Term UnversionedProtocol UnversionedProtocolData
-&gt; NetworkConnectTracers SockAddr UnversionedProtocol
-&gt; HandshakeCallbacks UnversionedProtocolData
-&gt; Versions
     UnversionedProtocol
     UnversionedProtocolData
     (OuroborosApplicationWithMinimalCtx
        appType SockAddr ByteString IO a b)
-&gt; Socket
-&gt; IO ()
forall (appType :: MuxMode) vNumber vData a b.
(Ord vNumber, Typeable vNumber, Show vNumber,
 HasInitiator appType ~ 'True) =&gt;
IOManager
-&gt; Codec (Handshake vNumber Term) DeserialiseFailure IO ByteString
-&gt; ProtocolTimeLimits (Handshake vNumber Term)
-&gt; VersionDataCodec Term vNumber vData
-&gt; NetworkConnectTracers SockAddr vNumber
-&gt; HandshakeCallbacks vData
-&gt; Versions
     vNumber
     vData
     (OuroborosApplicationWithMinimalCtx
        appType SockAddr ByteString IO a b)
-&gt; Socket
-&gt; IO ()
</span><span class="hs-identifier hs-var">connectToNodeSocket</span></span><span>
</span><span id="line-173"></span><span>      </span><span class="annot"><span class="annottext">IOManager
</span><a href="#local-6989586621680175637"><span class="hs-identifier hs-var">iomgr</span></a></span><span>
</span><span id="line-174"></span><span>      </span><span class="annot"><span class="annottext">Codec
  (Handshake UnversionedProtocol Term)
  DeserialiseFailure
  IO
  ByteString
forall (m :: * -&gt; *).
MonadST m =&gt;
Codec
  (Handshake UnversionedProtocol Term)
  DeserialiseFailure
  m
  ByteString
</span><span class="hs-identifier hs-var">unversionedHandshakeCodec</span></span><span>
</span><span id="line-175"></span><span>      </span><span class="annot"><span class="annottext">ProtocolTimeLimits (Handshake UnversionedProtocol Term)
forall {k} (vNumber :: k).
ProtocolTimeLimits (Handshake vNumber Term)
</span><span class="hs-identifier hs-var">noTimeLimitsHandshake</span></span><span>
</span><span id="line-176"></span><span>      </span><span class="annot"><span class="annottext">VersionDataCodec Term UnversionedProtocol UnversionedProtocolData
</span><span class="hs-identifier hs-var">unversionedProtocolDataCodec</span></span><span>
</span><span id="line-177"></span><span>      </span><span class="annot"><span class="annottext">NetworkConnectTracers SockAddr UnversionedProtocol
forall {addr} {vNumber}. NetworkConnectTracers addr vNumber
</span><a href="#local-6989586621680175642"><span class="hs-identifier hs-var">networkConnectTracers</span></a></span><span>
</span><span id="line-178"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnversionedProtocolData
 -&gt; UnversionedProtocolData -&gt; Accept UnversionedProtocolData)
-&gt; (UnversionedProtocolData -&gt; Bool)
-&gt; HandshakeCallbacks UnversionedProtocolData
forall vData.
(vData -&gt; vData -&gt; Accept vData)
-&gt; (vData -&gt; Bool) -&gt; HandshakeCallbacks vData
</span><span class="hs-identifier hs-var">HandshakeCallbacks</span></span><span> </span><span class="annot"><span class="annottext">UnversionedProtocolData
-&gt; UnversionedProtocolData -&gt; Accept UnversionedProtocolData
forall v. Acceptable v =&gt; v -&gt; v -&gt; Accept v
</span><span class="hs-identifier hs-var">acceptableVersion</span></span><span> </span><span class="annot"><span class="annottext">UnversionedProtocolData -&gt; Bool
forall v. Queryable v =&gt; v -&gt; Bool
</span><span class="hs-identifier hs-var">queryVersion</span></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OuroborosApplicationWithMinimalCtx
  appType SockAddr ByteString IO a b
-&gt; Versions
     UnversionedProtocol
     UnversionedProtocolData
     (OuroborosApplicationWithMinimalCtx
        appType SockAddr ByteString IO a b)
forall app.
app -&gt; Versions UnversionedProtocol UnversionedProtocolData app
</span><span class="hs-identifier hs-var">unversionedProtocol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
-&gt; OuroborosApplicationWithMinimalCtx
     appType SockAddr ByteString IO a b
</span><a href="#local-6989586621680175639"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680175641"><span class="hs-identifier hs-var">chan</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>      </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621680175640"><span class="hs-identifier hs-var">sn</span></a></span><span>
</span><span id="line-181"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-182"></span><span>    </span><span id="local-6989586621680175642"><span class="annot"><span class="annottext">networkConnectTracers :: NetworkConnectTracers addr vNumber
</span><a href="#local-6989586621680175642"><span class="hs-identifier hs-var hs-var">networkConnectTracers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-183"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">NetworkConnectTracers</span></span><span>
</span><span id="line-184"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nctMuxTracer :: Tracer IO (WithMuxBearer (ConnectionId addr) MuxTrace)
</span><a href="#local-6989586621680175647"><span class="hs-identifier hs-var">nctMuxTracer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer IO (WithMuxBearer (ConnectionId addr) MuxTrace)
forall (m :: * -&gt; *) a. Applicative m =&gt; Tracer m a
</span><span class="hs-identifier hs-var">nullTracer</span></span><span>
</span><span id="line-185"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nctHandshakeTracer :: Tracer
  IO
  (WithMuxBearer
     (ConnectionId addr) (TraceSendRecv (Handshake vNumber Term)))
</span><a href="#local-6989586621680175648"><span class="hs-identifier hs-var">nctHandshakeTracer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer
  IO
  (WithMuxBearer
     (ConnectionId addr) (TraceSendRecv (Handshake vNumber Term)))
forall (m :: * -&gt; *) a. Applicative m =&gt; Tracer m a
</span><span class="hs-identifier hs-var">nullTracer</span></span><span>
</span><span id="line-186"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span>  </span><span id="local-6989586621680175566"><span class="annot"><span class="annottext">withServerListening :: IOManager
-&gt; OuroborosApplicationWithMinimalCtx
     'ResponderMode SockAddr ByteString IO Void ()
-&gt; IO ()
-&gt; IO ()
</span><a href="#local-6989586621680175566"><span class="hs-identifier hs-var hs-var">withServerListening</span></a></span></span><span> </span><span id="local-6989586621680175649"><span class="annot"><span class="annottext">IOManager
</span><a href="#local-6989586621680175649"><span class="hs-identifier hs-var">iomgr</span></a></span></span><span> </span><span id="local-6989586621680175650"><span class="annot"><span class="annottext">OuroborosApplicationWithMinimalCtx
  'ResponderMode SockAddr ByteString IO Void ()
</span><a href="#local-6989586621680175650"><span class="hs-identifier hs-var">app</span></a></span></span><span> </span><span id="local-6989586621680175651"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621680175651"><span class="hs-identifier hs-var">continuation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-189"></span><span>    </span><span id="local-6989586621680175652"><span class="annot"><span class="annottext">NetworkMutableState SockAddr
</span><a href="#local-6989586621680175652"><span class="hs-identifier hs-var">networkState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (NetworkMutableState SockAddr)
forall addr. IO (NetworkMutableState addr)
</span><span class="hs-identifier hs-var">newNetworkMutableState</span></span><span>
</span><span id="line-190"></span><span>    </span><span id="local-6989586621680175653"><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621680175653"><span class="hs-identifier hs-var">localAddr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Host -&gt; IO SockAddr
</span><a href="#local-6989586621680175590"><span class="hs-identifier hs-var">resolveSockAddr</span></a></span><span> </span><span class="annot"><span class="annottext">Host
</span><a href="#local-6989586621680175558"><span class="hs-identifier hs-var">localHost</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-comment">-- TODO(SN): whats this? _ &lt;- async $ cleanNetworkMutableState networkState</span><span>
</span><span id="line-192"></span><span>    </span><span class="annot"><span class="annottext">(IOException -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall e a. Exception e =&gt; (e -&gt; IO a) -&gt; IO a -&gt; IO a
forall (m :: * -&gt; *) e a.
(MonadCatch m, Exception e) =&gt;
(e -&gt; m a) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">handle</span></span><span> </span><span class="annot"><span class="annottext">IOException -&gt; IO ()
</span><a href="#local-6989586621680175655"><span class="hs-identifier hs-var">onIOException</span></a></span><span>
</span><span id="line-193"></span><span>      </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SocketSnocket
-&gt; MakeBearer IO Socket
-&gt; (Socket -&gt; SockAddr -&gt; IO ())
-&gt; NetworkServerTracers SockAddr UnversionedProtocol
-&gt; NetworkMutableState SockAddr
-&gt; AcceptedConnectionsLimit
-&gt; SockAddr
-&gt; Codec
     (Handshake UnversionedProtocol Term)
     DeserialiseFailure
     IO
     ByteString
-&gt; ProtocolTimeLimits (Handshake UnversionedProtocol Term)
-&gt; VersionDataCodec
     Term UnversionedProtocol UnversionedProtocolData
-&gt; HandshakeCallbacks UnversionedProtocolData
-&gt; Versions
     UnversionedProtocol
     UnversionedProtocolData
     (SomeResponderApplication SockAddr ByteString IO ())
-&gt; ErrorPolicies
-&gt; (SockAddr -&gt; Async Void -&gt; IO ())
-&gt; IO ()
forall vNumber vData t fd addr b.
(Ord vNumber, Typeable vNumber, Show vNumber, Ord addr) =&gt;
Snocket IO fd addr
-&gt; MakeBearer IO fd
-&gt; (fd -&gt; addr -&gt; IO ())
-&gt; NetworkServerTracers addr vNumber
-&gt; NetworkMutableState addr
-&gt; AcceptedConnectionsLimit
-&gt; addr
-&gt; Codec (Handshake vNumber Term) DeserialiseFailure IO ByteString
-&gt; ProtocolTimeLimits (Handshake vNumber Term)
-&gt; VersionDataCodec Term vNumber vData
-&gt; HandshakeCallbacks vData
-&gt; Versions
     vNumber vData (SomeResponderApplication addr ByteString IO b)
-&gt; ErrorPolicies
-&gt; (addr -&gt; Async Void -&gt; IO t)
-&gt; IO t
</span><span class="hs-identifier hs-var">withServerNode</span></span><span>
</span><span id="line-194"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOManager -&gt; SocketSnocket
</span><span class="hs-identifier hs-var">socketSnocket</span></span><span> </span><span class="annot"><span class="annottext">IOManager
</span><a href="#local-6989586621680175649"><span class="hs-identifier hs-var">iomgr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>        </span><span class="annot"><span class="annottext">MakeBearer IO Socket
</span><span class="hs-identifier hs-var">makeSocketBearer</span></span><span>
</span><span id="line-196"></span><span>        </span><span class="annot"><span class="annottext">Socket -&gt; SockAddr -&gt; IO ()
forall {f :: * -&gt; *} {p} {p}. Applicative f =&gt; p -&gt; p -&gt; f ()
</span><a href="#local-6989586621680175656"><span class="hs-identifier hs-var">notConfigureSocket</span></a></span><span>
</span><span id="line-197"></span><span>        </span><span class="annot"><span class="annottext">NetworkServerTracers SockAddr UnversionedProtocol
</span><a href="#local-6989586621680175657"><span class="hs-identifier hs-var">networkServerTracers</span></a></span><span>
</span><span id="line-198"></span><span>        </span><span class="annot"><span class="annottext">NetworkMutableState SockAddr
</span><a href="#local-6989586621680175652"><span class="hs-identifier hs-var">networkState</span></a></span><span>
</span><span id="line-199"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; DiffTime -&gt; AcceptedConnectionsLimit
</span><span class="hs-identifier hs-var">AcceptedConnectionsLimit</span></span><span> </span><span class="annot"><span class="annottext">Word32
forall a. Bounded a =&gt; a
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Enum.html#maxBound"><span class="hs-identifier hs-var">maxBound</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
forall a. Bounded a =&gt; a
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Enum.html#maxBound"><span class="hs-identifier hs-var">maxBound</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>        </span><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621680175653"><span class="hs-identifier hs-var">localAddr</span></a></span><span>
</span><span id="line-201"></span><span>        </span><span class="annot"><span class="annottext">Codec
  (Handshake UnversionedProtocol Term)
  DeserialiseFailure
  IO
  ByteString
forall (m :: * -&gt; *).
MonadST m =&gt;
Codec
  (Handshake UnversionedProtocol Term)
  DeserialiseFailure
  m
  ByteString
</span><span class="hs-identifier hs-var">unversionedHandshakeCodec</span></span><span>
</span><span id="line-202"></span><span>        </span><span class="annot"><span class="annottext">ProtocolTimeLimits (Handshake UnversionedProtocol Term)
forall {k} (vNumber :: k).
ProtocolTimeLimits (Handshake vNumber Term)
</span><span class="hs-identifier hs-var">noTimeLimitsHandshake</span></span><span>
</span><span id="line-203"></span><span>        </span><span class="annot"><span class="annottext">VersionDataCodec Term UnversionedProtocol UnversionedProtocolData
</span><span class="hs-identifier hs-var">unversionedProtocolDataCodec</span></span><span>
</span><span id="line-204"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnversionedProtocolData
 -&gt; UnversionedProtocolData -&gt; Accept UnversionedProtocolData)
-&gt; (UnversionedProtocolData -&gt; Bool)
-&gt; HandshakeCallbacks UnversionedProtocolData
forall vData.
(vData -&gt; vData -&gt; Accept vData)
-&gt; (vData -&gt; Bool) -&gt; HandshakeCallbacks vData
</span><span class="hs-identifier hs-var">HandshakeCallbacks</span></span><span> </span><span class="annot"><span class="annottext">UnversionedProtocolData
-&gt; UnversionedProtocolData -&gt; Accept UnversionedProtocolData
forall v. Acceptable v =&gt; v -&gt; v -&gt; Accept v
</span><span class="hs-identifier hs-var">acceptableVersion</span></span><span> </span><span class="annot"><span class="annottext">UnversionedProtocolData -&gt; Bool
forall v. Queryable v =&gt; v -&gt; Bool
</span><span class="hs-identifier hs-var">queryVersion</span></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeResponderApplication SockAddr ByteString IO ()
-&gt; Versions
     UnversionedProtocol
     UnversionedProtocolData
     (SomeResponderApplication SockAddr ByteString IO ())
forall app.
app -&gt; Versions UnversionedProtocol UnversionedProtocolData app
</span><span class="hs-identifier hs-var">unversionedProtocol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OuroborosApplicationWithMinimalCtx
  'ResponderMode SockAddr ByteString IO Void ()
-&gt; SomeResponderApplication SockAddr ByteString IO ()
forall (appType :: MuxMode) addr bytes (m :: * -&gt; *) a b.
(HasResponder appType ~ 'True) =&gt;
OuroborosApplicationWithMinimalCtx appType addr bytes m a b
-&gt; SomeResponderApplication addr bytes m b
</span><span class="hs-identifier hs-var">SomeResponderApplication</span></span><span> </span><span class="annot"><span class="annottext">OuroborosApplicationWithMinimalCtx
  'ResponderMode SockAddr ByteString IO Void ()
</span><a href="#local-6989586621680175650"><span class="hs-identifier hs-var">app</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>        </span><span class="annot"><span class="annottext">ErrorPolicies
</span><span class="hs-identifier hs-var">nullErrorPolicies</span></span><span>
</span><span id="line-207"></span><span>      </span><span class="annot"><span class="annottext">((SockAddr -&gt; Async Void -&gt; IO ()) -&gt; IO ())
-&gt; (SockAddr -&gt; Async Void -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680175660"><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621680175660"><span class="hs-identifier hs-var">_addr</span></a></span></span><span> </span><span id="local-6989586621680175661"><span class="annot"><span class="annottext">Async Void
</span><a href="#local-6989586621680175661"><span class="hs-identifier hs-var">serverAsync</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-208"></span><span>        </span><span class="annot"><span class="annottext">IO Void -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO ()
forall (m :: * -&gt; *) a b. MonadAsync m =&gt; m a -&gt; m b -&gt; m ()
</span><span class="hs-identifier hs-var">race_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Async IO Void -&gt; IO Void
forall a. Async IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadAsync m =&gt; Async m a -&gt; m a
</span><span class="hs-identifier hs-var">wait</span></span><span> </span><span class="annot"><span class="annottext">Async Void
Async IO Void
</span><a href="#local-6989586621680175661"><span class="hs-identifier hs-var">serverAsync</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621680175651"><span class="hs-identifier hs-var">continuation</span></a></span><span>
</span><span id="line-209"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-210"></span><span>    </span><span id="local-6989586621680175656"><span class="annot"><span class="annottext">notConfigureSocket :: p -&gt; p -&gt; f ()
</span><a href="#local-6989586621680175656"><span class="hs-identifier hs-var hs-var">notConfigureSocket</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; f ()
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span>    </span><span id="local-6989586621680175657"><span class="annot"><span class="annottext">networkServerTracers :: NetworkServerTracers SockAddr UnversionedProtocol
</span><a href="#local-6989586621680175657"><span class="hs-identifier hs-var hs-var">networkServerTracers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-213"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">NetworkServerTracers</span></span><span>
</span><span id="line-214"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nstMuxTracer :: Tracer IO (WithMuxBearer (ConnectionId SockAddr) MuxTrace)
</span><a href="#local-6989586621680175668"><span class="hs-identifier hs-var">nstMuxTracer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer IO (WithMuxBearer (ConnectionId SockAddr) MuxTrace)
forall (m :: * -&gt; *) a. Applicative m =&gt; Tracer m a
</span><span class="hs-identifier hs-var">nullTracer</span></span><span>
</span><span id="line-215"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nstHandshakeTracer :: Tracer
  IO
  (WithMuxBearer
     (ConnectionId SockAddr)
     (TraceSendRecv (Handshake UnversionedProtocol Term)))
</span><a href="#local-6989586621680175669"><span class="hs-identifier hs-var">nstHandshakeTracer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer
  IO
  (WithMuxBearer
     (ConnectionId SockAddr)
     (TraceSendRecv (Handshake UnversionedProtocol Term)))
forall (m :: * -&gt; *) a. Applicative m =&gt; Tracer m a
</span><span class="hs-identifier hs-var">nullTracer</span></span><span>
</span><span id="line-216"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nstErrorPolicyTracer :: Tracer IO (WithAddr SockAddr ErrorPolicyTrace)
</span><a href="#local-6989586621680175670"><span class="hs-identifier hs-var">nstErrorPolicyTracer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WithAddr SockAddr ErrorPolicyTrace
 -&gt; WithHost (TraceOuroborosNetwork msg))
-&gt; Tracer IO (WithHost (TraceOuroborosNetwork msg))
-&gt; Tracer IO (WithAddr SockAddr ErrorPolicyTrace)
forall a' a. (a' -&gt; a) -&gt; Tracer IO a -&gt; Tracer IO a'
forall (f :: * -&gt; *) a' a.
Contravariant f =&gt;
(a' -&gt; a) -&gt; f a -&gt; f a'
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.Contravariant.html#contramap"><span class="hs-identifier hs-var">contramap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Host
-&gt; TraceOuroborosNetwork msg
-&gt; WithHost (TraceOuroborosNetwork msg)
forall trace. Host -&gt; trace -&gt; WithHost trace
</span><a href="Hydra.Network.Ouroboros.html#WithHost"><span class="hs-identifier hs-var">WithHost</span></a></span><span> </span><span class="annot"><span class="annottext">Host
</span><a href="#local-6989586621680175558"><span class="hs-identifier hs-var">localHost</span></a></span><span> </span><span class="annot"><span class="annottext">(TraceOuroborosNetwork msg -&gt; WithHost (TraceOuroborosNetwork msg))
-&gt; (WithAddr SockAddr ErrorPolicyTrace
    -&gt; TraceOuroborosNetwork msg)
-&gt; WithAddr SockAddr ErrorPolicyTrace
-&gt; WithHost (TraceOuroborosNetwork msg)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">WithAddr SockAddr ErrorPolicyTrace -&gt; TraceOuroborosNetwork msg
forall {k} (msg :: k).
WithAddr SockAddr ErrorPolicyTrace -&gt; TraceOuroborosNetwork msg
</span><a href="Hydra.Network.Ouroboros.html#TraceErrorPolicy"><span class="hs-identifier hs-var">TraceErrorPolicy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tracer IO (WithHost (TraceOuroborosNetwork msg))
</span><a href="#local-6989586621680175557"><span class="hs-identifier hs-var">tracer</span></a></span><span>
</span><span id="line-217"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nstAcceptPolicyTracer :: Tracer IO AcceptConnectionsPolicyTrace
</span><a href="#local-6989586621680175671"><span class="hs-identifier hs-var">nstAcceptPolicyTracer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AcceptConnectionsPolicyTrace
 -&gt; WithHost (TraceOuroborosNetwork msg))
-&gt; Tracer IO (WithHost (TraceOuroborosNetwork msg))
-&gt; Tracer IO AcceptConnectionsPolicyTrace
forall a' a. (a' -&gt; a) -&gt; Tracer IO a -&gt; Tracer IO a'
forall (f :: * -&gt; *) a' a.
Contravariant f =&gt;
(a' -&gt; a) -&gt; f a -&gt; f a'
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.Contravariant.html#contramap"><span class="hs-identifier hs-var">contramap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Host
-&gt; TraceOuroborosNetwork msg
-&gt; WithHost (TraceOuroborosNetwork msg)
forall trace. Host -&gt; trace -&gt; WithHost trace
</span><a href="Hydra.Network.Ouroboros.html#WithHost"><span class="hs-identifier hs-var">WithHost</span></a></span><span> </span><span class="annot"><span class="annottext">Host
</span><a href="#local-6989586621680175558"><span class="hs-identifier hs-var">localHost</span></a></span><span> </span><span class="annot"><span class="annottext">(TraceOuroborosNetwork msg -&gt; WithHost (TraceOuroborosNetwork msg))
-&gt; (AcceptConnectionsPolicyTrace -&gt; TraceOuroborosNetwork msg)
-&gt; AcceptConnectionsPolicyTrace
-&gt; WithHost (TraceOuroborosNetwork msg)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">AcceptConnectionsPolicyTrace -&gt; TraceOuroborosNetwork msg
forall {k} (msg :: k).
AcceptConnectionsPolicyTrace -&gt; TraceOuroborosNetwork msg
</span><a href="Hydra.Network.Ouroboros.html#TraceAcceptPolicy"><span class="hs-identifier hs-var">TraceAcceptPolicy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tracer IO (WithHost (TraceOuroborosNetwork msg))
</span><a href="#local-6989586621680175557"><span class="hs-identifier hs-var">tracer</span></a></span><span>
</span><span id="line-218"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span>    </span><span id="local-6989586621680175655"><span class="annot"><span class="annottext">onIOException :: IOException -&gt; IO ()
</span><a href="#local-6989586621680175655"><span class="hs-identifier hs-var hs-var">onIOException</span></a></span></span><span> </span><span id="local-6989586621680175673"><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621680175673"><span class="hs-identifier hs-var">ioException</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-221"></span><span>      </span><span class="annot"><span class="annottext">NetworkServerListenException -&gt; IO ()
forall e a. Exception e =&gt; e -&gt; IO a
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(NetworkServerListenException -&gt; IO ())
-&gt; NetworkServerListenException -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-222"></span><span>        </span><span class="annot"><a href="Hydra.Network.Ouroboros.html#NetworkServerListenException"><span class="hs-identifier hs-type">NetworkServerListenException</span></a></span><span>
</span><span id="line-223"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">IOException
ioException :: IOException
ioException :: IOException
</span><a href="#local-6989586621680175673"><span class="hs-identifier hs-var hs-var">ioException</span></a></span><span>
</span><span id="line-224"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Host
localHost :: Host
localHost :: Host
</span><a href="#local-6989586621680175558"><span class="hs-identifier hs-var hs-var">localHost</span></a></span><span>
</span><span id="line-225"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span>  </span><span id="local-6989586621680175136"><span class="annot"><a href="#local-6989586621680175570"><span class="hs-identifier hs-type">hydraClient</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-228"></span><span>    </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.TChan.html#TChan"><span class="hs-identifier hs-type">TChan</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680175086"><span class="hs-identifier hs-type">msg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-229"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">OuroborosApplicationWithMinimalCtx</span></span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">InitiatorMode</span></span><span> </span><span class="annot"><a href="#local-6989586621680175136"><span class="hs-identifier hs-type">addr</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LByteString</span></span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#Void"><span class="hs-identifier hs-type">Void</span></a></span></span><span>
</span><span id="line-230"></span><span>  </span><span id="local-6989586621680175570"><span class="annot"><span class="annottext">hydraClient :: forall addr.
TChan msg
-&gt; OuroborosApplicationWithMinimalCtx
     'InitiatorMode addr ByteString IO () Void
</span><a href="#local-6989586621680175570"><span class="hs-identifier hs-var hs-var">hydraClient</span></a></span></span><span> </span><span id="local-6989586621680175681"><span class="annot"><span class="annottext">TChan msg
</span><a href="#local-6989586621680175681"><span class="hs-identifier hs-var">chan</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-231"></span><span>    </span><span class="annot"><span class="annottext">[MiniProtocol
   'InitiatorMode
   (MinimalInitiatorContext addr)
   (ResponderContext addr)
   ByteString
   IO
   ()
   Void]
-&gt; OuroborosApplication
     'InitiatorMode
     (MinimalInitiatorContext addr)
     (ResponderContext addr)
     ByteString
     IO
     ()
     Void
forall (mode :: MuxMode) initiatorCtx responderCtx bytes
       (m :: * -&gt; *) a b.
[MiniProtocol mode initiatorCtx responderCtx bytes m a b]
-&gt; OuroborosApplication mode initiatorCtx responderCtx bytes m a b
</span><span class="hs-identifier hs-var">OuroborosApplication</span></span><span>
</span><span id="line-232"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MiniProtocol</span></span><span>
</span><span id="line-233"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">miniProtocolNum :: MiniProtocolNum
</span><span class="hs-identifier hs-var">miniProtocolNum</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; MiniProtocolNum
</span><span class="hs-identifier hs-var">MiniProtocolNum</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">42</span></span><span>
</span><span id="line-234"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">miniProtocolLimits :: MiniProtocolLimits
</span><span class="hs-identifier hs-var">miniProtocolLimits</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MiniProtocolLimits
</span><a href="#local-6989586621680175683"><span class="hs-identifier hs-var">maximumMiniProtocolLimits</span></a></span><span>
</span><span id="line-235"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">miniProtocolRun :: RunMiniProtocol
  'InitiatorMode
  (MinimalInitiatorContext addr)
  (ResponderContext addr)
  ByteString
  IO
  ()
  Void
</span><span class="hs-identifier hs-var">miniProtocolRun</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MiniProtocolCb (MinimalInitiatorContext addr) ByteString IO ()
-&gt; RunMiniProtocol
     'InitiatorMode
     (MinimalInitiatorContext addr)
     (ResponderContext addr)
     ByteString
     IO
     ()
     Void
forall initiatorCtx bytes (m :: * -&gt; *) a responderCtx.
MiniProtocolCb initiatorCtx bytes m a
-&gt; RunMiniProtocol
     'InitiatorMode initiatorCtx responderCtx bytes m a Void
</span><span class="hs-identifier hs-var">InitiatorProtocolOnly</span></span><span> </span><span class="annot"><span class="annottext">MiniProtocolCb (MinimalInitiatorContext addr) ByteString IO ()
forall ctx. MiniProtocolCb ctx ByteString IO ()
</span><a href="#local-6989586621680175685"><span class="hs-identifier hs-var">initiator</span></a></span><span>
</span><span id="line-236"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-237"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-238"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-239"></span><span>    </span><span id="local-6989586621680175269"><span class="annot"><a href="#local-6989586621680175685"><span class="hs-identifier hs-type">initiator</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MiniProtocolCb</span></span><span> </span><span class="annot"><a href="#local-6989586621680175269"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LByteString</span></span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-240"></span><span>    </span><span id="local-6989586621680175685"><span class="annot"><span class="annottext">initiator :: forall ctx. MiniProtocolCb ctx ByteString IO ()
</span><a href="#local-6989586621680175685"><span class="hs-identifier hs-var hs-var">initiator</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-241"></span><span>      </span><span class="annot"><span class="annottext">(ctx
 -&gt; (Tracer IO (TraceSendRecv (FireForget msg)),
     Codec (FireForget msg) DeserialiseFailure IO ByteString,
     Peer (FireForget msg) 'AsClient 'StIdle IO ()))
-&gt; MiniProtocolCb ctx ByteString IO ()
forall (pr :: PeerRole) ps (st :: ps) failure bytes ctx
       (m :: * -&gt; *) a.
(MonadThrow m, Show failure,
 forall (st' :: ps). Show (ClientHasAgency st'),
 forall (st' :: ps). Show (ServerHasAgency st'), ShowProxy ps) =&gt;
(ctx
 -&gt; (Tracer m (TraceSendRecv ps), Codec ps failure m bytes,
     Peer ps pr st m a))
-&gt; MiniProtocolCb ctx bytes m a
</span><span class="hs-identifier hs-var">mkMiniProtocolCbFromPeer</span></span><span>
</span><span id="line-242"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(Tracer IO (TraceSendRecv (FireForget msg)),
 Codec (FireForget msg) DeserialiseFailure IO ByteString,
 Peer (FireForget msg) 'AsClient 'StIdle IO ())
-&gt; ctx
-&gt; (Tracer IO (TraceSendRecv (FireForget msg)),
    Codec (FireForget msg) DeserialiseFailure IO ByteString,
    Peer (FireForget msg) 'AsClient 'StIdle IO ())
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span>
</span><span id="line-243"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tracer IO (TraceSendRecv (FireForget msg))
forall (m :: * -&gt; *) a. Applicative m =&gt; Tracer m a
</span><span class="hs-identifier hs-var">nullTracer</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Codec (FireForget msg) DeserialiseFailure IO ByteString
forall a (m :: * -&gt; *).
(MonadST m, ToCBOR a, FromCBOR a) =&gt;
Codec (FireForget a) DeserialiseFailure m ByteString
</span><a href="Hydra.Network.Ouroboros.Type.html#codecFireForget"><span class="hs-identifier hs-var">codecFireForget</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FireForgetClient msg IO ()
-&gt; Peer (FireForget msg) 'AsClient 'StIdle IO ()
forall (m :: * -&gt; *) msg a.
Monad m =&gt;
FireForgetClient msg m a
-&gt; Peer (FireForget msg) 'AsClient 'StIdle m a
</span><a href="Hydra.Network.Ouroboros.Client.html#fireForgetClientPeer"><span class="hs-identifier hs-var">fireForgetClientPeer</span></a></span><span> </span><span class="annot"><span class="annottext">(FireForgetClient msg IO ()
 -&gt; Peer (FireForget msg) 'AsClient 'StIdle IO ())
-&gt; FireForgetClient msg IO ()
-&gt; Peer (FireForget msg) 'AsClient 'StIdle IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TChan msg -&gt; FireForgetClient msg IO ()
</span><a href="#local-6989586621680175698"><span class="hs-identifier hs-var">client</span></a></span><span> </span><span class="annot"><span class="annottext">TChan msg
</span><a href="#local-6989586621680175681"><span class="hs-identifier hs-var">chan</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span>  </span><span id="local-6989586621680175132"><span class="annot"><a href="#local-6989586621680175567"><span class="hs-identifier hs-type">hydraServer</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-247"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">OuroborosApplicationWithMinimalCtx</span></span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">ResponderMode</span></span><span> </span><span class="annot"><a href="#local-6989586621680175132"><span class="hs-identifier hs-type">addr</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LByteString</span></span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#Void"><span class="hs-identifier hs-type">Void</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-248"></span><span>  </span><span id="local-6989586621680175567"><span class="annot"><span class="annottext">hydraServer :: forall addr.
OuroborosApplicationWithMinimalCtx
  'ResponderMode addr ByteString IO Void ()
</span><a href="#local-6989586621680175567"><span class="hs-identifier hs-var hs-var">hydraServer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-249"></span><span>    </span><span class="annot"><span class="annottext">[MiniProtocol
   'ResponderMode
   (MinimalInitiatorContext addr)
   (ResponderContext addr)
   ByteString
   IO
   Void
   ()]
-&gt; OuroborosApplication
     'ResponderMode
     (MinimalInitiatorContext addr)
     (ResponderContext addr)
     ByteString
     IO
     Void
     ()
forall (mode :: MuxMode) initiatorCtx responderCtx bytes
       (m :: * -&gt; *) a b.
[MiniProtocol mode initiatorCtx responderCtx bytes m a b]
-&gt; OuroborosApplication mode initiatorCtx responderCtx bytes m a b
</span><span class="hs-identifier hs-var">OuroborosApplication</span></span><span>
</span><span id="line-250"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MiniProtocol</span></span><span>
</span><span id="line-251"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">miniProtocolNum :: MiniProtocolNum
</span><span class="hs-identifier hs-var">miniProtocolNum</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; MiniProtocolNum
</span><span class="hs-identifier hs-var">MiniProtocolNum</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">42</span></span><span>
</span><span id="line-252"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">miniProtocolLimits :: MiniProtocolLimits
</span><span class="hs-identifier hs-var">miniProtocolLimits</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MiniProtocolLimits
</span><a href="#local-6989586621680175683"><span class="hs-identifier hs-var">maximumMiniProtocolLimits</span></a></span><span>
</span><span id="line-253"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">miniProtocolRun :: RunMiniProtocol
  'ResponderMode
  (MinimalInitiatorContext addr)
  (ResponderContext addr)
  ByteString
  IO
  Void
  ()
</span><span class="hs-identifier hs-var">miniProtocolRun</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MiniProtocolCb (ResponderContext addr) ByteString IO ()
-&gt; RunMiniProtocol
     'ResponderMode
     (MinimalInitiatorContext addr)
     (ResponderContext addr)
     ByteString
     IO
     Void
     ()
forall responderCtx bytes (m :: * -&gt; *) b initiatorCtx.
MiniProtocolCb responderCtx bytes m b
-&gt; RunMiniProtocol
     'ResponderMode initiatorCtx responderCtx bytes m Void b
</span><span class="hs-identifier hs-var">ResponderProtocolOnly</span></span><span> </span><span class="annot"><span class="annottext">MiniProtocolCb (ResponderContext addr) ByteString IO ()
forall ctx. MiniProtocolCb ctx ByteString IO ()
</span><a href="#local-6989586621680175701"><span class="hs-identifier hs-var">responder</span></a></span><span>
</span><span id="line-254"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-255"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-256"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-257"></span><span>    </span><span id="local-6989586621680175702"><span class="annot"><a href="#local-6989586621680175701"><span class="hs-identifier hs-type">responder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MiniProtocolCb</span></span><span> </span><span class="annot"><a href="#local-6989586621680175702"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LByteString</span></span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-258"></span><span>    </span><span id="local-6989586621680175701"><span class="annot"><span class="annottext">responder :: forall ctx. MiniProtocolCb ctx ByteString IO ()
</span><a href="#local-6989586621680175701"><span class="hs-identifier hs-var hs-var">responder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ctx
 -&gt; (Tracer IO (TraceSendRecv (FireForget msg)),
     Codec (FireForget msg) DeserialiseFailure IO ByteString,
     Peer (FireForget msg) 'AsServer 'StIdle IO ()))
-&gt; MiniProtocolCb ctx ByteString IO ()
forall (pr :: PeerRole) ps (st :: ps) failure bytes ctx
       (m :: * -&gt; *) a.
(MonadThrow m, Show failure,
 forall (st' :: ps). Show (ClientHasAgency st'),
 forall (st' :: ps). Show (ServerHasAgency st'), ShowProxy ps) =&gt;
(ctx
 -&gt; (Tracer m (TraceSendRecv ps), Codec ps failure m bytes,
     Peer ps pr st m a))
-&gt; MiniProtocolCb ctx bytes m a
</span><span class="hs-identifier hs-var">mkMiniProtocolCbFromPeer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Tracer IO (TraceSendRecv (FireForget msg)),
 Codec (FireForget msg) DeserialiseFailure IO ByteString,
 Peer (FireForget msg) 'AsServer 'StIdle IO ())
-&gt; ctx
-&gt; (Tracer IO (TraceSendRecv (FireForget msg)),
    Codec (FireForget msg) DeserialiseFailure IO ByteString,
    Peer (FireForget msg) 'AsServer 'StIdle IO ())
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tracer IO (TraceSendRecv (FireForget msg))
forall (m :: * -&gt; *) a. Applicative m =&gt; Tracer m a
</span><span class="hs-identifier hs-var">nullTracer</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Codec (FireForget msg) DeserialiseFailure IO ByteString
forall a (m :: * -&gt; *).
(MonadST m, ToCBOR a, FromCBOR a) =&gt;
Codec (FireForget a) DeserialiseFailure m ByteString
</span><a href="Hydra.Network.Ouroboros.Type.html#codecFireForget"><span class="hs-identifier hs-var">codecFireForget</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FireForgetServer msg IO ()
-&gt; Peer (FireForget msg) 'AsServer 'StIdle IO ()
forall (m :: * -&gt; *) msg a.
Monad m =&gt;
FireForgetServer msg m a
-&gt; Peer (FireForget msg) 'AsServer 'StIdle m a
</span><a href="Hydra.Network.Ouroboros.Server.html#fireForgetServerPeer"><span class="hs-identifier hs-var">fireForgetServerPeer</span></a></span><span> </span><span class="annot"><span class="annottext">FireForgetServer msg IO ()
</span><a href="#local-6989586621680175713"><span class="hs-identifier hs-var">server</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span>  </span><span class="hs-comment">-- TODO: provide sensible limits</span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-comment">-- https://github.com/input-output-hk/ouroboros-network/issues/575</span><span>
</span><span id="line-262"></span><span>  </span><span class="annot"><a href="#local-6989586621680175683"><span class="hs-identifier hs-type">maximumMiniProtocolLimits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MiniProtocolLimits</span></span><span>
</span><span id="line-263"></span><span>  </span><span id="local-6989586621680175683"><span class="annot"><span class="annottext">maximumMiniProtocolLimits :: MiniProtocolLimits
</span><a href="#local-6989586621680175683"><span class="hs-identifier hs-var hs-var">maximumMiniProtocolLimits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-264"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MiniProtocolLimits</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">maximumIngressQueue :: Int
</span><span class="hs-identifier hs-var">maximumIngressQueue</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
forall a. Bounded a =&gt; a
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Enum.html#maxBound"><span class="hs-identifier hs-var">maxBound</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span>  </span><span class="annot"><a href="#local-6989586621680175698"><span class="hs-identifier hs-type">client</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-267"></span><span>    </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.TChan.html#TChan"><span class="hs-identifier hs-type">TChan</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680175086"><span class="hs-identifier hs-type">msg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-268"></span><span>    </span><span class="annot"><a href="Hydra.Network.Ouroboros.Client.html#FireForgetClient"><span class="hs-identifier hs-type">FireForgetClient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680175086"><span class="hs-identifier hs-type">msg</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>  </span><span id="local-6989586621680175698"><span class="annot"><span class="annottext">client :: TChan msg -&gt; FireForgetClient msg IO ()
</span><a href="#local-6989586621680175698"><span class="hs-identifier hs-var hs-var">client</span></a></span></span><span> </span><span id="local-6989586621680175716"><span class="annot"><span class="annottext">TChan msg
</span><a href="#local-6989586621680175716"><span class="hs-identifier hs-var">chan</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-270"></span><span>    </span><span class="annot"><span class="annottext">IO (FireForgetClient msg IO ()) -&gt; FireForgetClient msg IO ()
forall (m :: * -&gt; *) msg a.
m (FireForgetClient msg m a) -&gt; FireForgetClient msg m a
</span><a href="Hydra.Network.Ouroboros.Client.html#Idle"><span class="hs-identifier hs-var">Idle</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (FireForgetClient msg IO ()) -&gt; FireForgetClient msg IO ())
-&gt; IO (FireForgetClient msg IO ()) -&gt; FireForgetClient msg IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-271"></span><span>      </span><span class="annot"><span class="annottext">STM IO msg -&gt; IO msg
forall a. HasCallStack =&gt; STM IO a -&gt; IO a
forall (m :: * -&gt; *) a.
(MonadSTM m, HasCallStack) =&gt;
STM m a -&gt; m a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TChan msg -&gt; STM msg
forall a. TChan a -&gt; STM a
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/stm-2.5.1.0/src/Control.Concurrent.STM.TChan.html#readTChan"><span class="hs-identifier hs-var">readTChan</span></a></span><span> </span><span class="annot"><span class="annottext">TChan msg
</span><a href="#local-6989586621680175716"><span class="hs-identifier hs-var">chan</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO msg
-&gt; (msg -&gt; FireForgetClient msg IO ())
-&gt; IO (FireForgetClient msg IO ())
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%3C%26%3E"><span class="hs-operator hs-var">&lt;&amp;&gt;</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680175719"><span class="annot"><span class="annottext">msg
</span><a href="#local-6989586621680175719"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-272"></span><span>        </span><span class="annot"><span class="annottext">msg
-&gt; IO (FireForgetClient msg IO ()) -&gt; FireForgetClient msg IO ()
forall msg (m :: * -&gt; *) a.
msg -&gt; m (FireForgetClient msg m a) -&gt; FireForgetClient msg m a
</span><a href="Hydra.Network.Ouroboros.Client.html#SendMsg"><span class="hs-identifier hs-var">SendMsg</span></a></span><span> </span><span class="annot"><span class="annottext">msg
</span><a href="#local-6989586621680175719"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FireForgetClient msg IO () -&gt; IO (FireForgetClient msg IO ())
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(FireForgetClient msg IO () -&gt; IO (FireForgetClient msg IO ()))
-&gt; FireForgetClient msg IO () -&gt; IO (FireForgetClient msg IO ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TChan msg -&gt; FireForgetClient msg IO ()
</span><a href="#local-6989586621680175698"><span class="hs-identifier hs-var">client</span></a></span><span> </span><span class="annot"><span class="annottext">TChan msg
</span><a href="#local-6989586621680175716"><span class="hs-identifier hs-var">chan</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span>  </span><span class="annot"><a href="#local-6989586621680175713"><span class="hs-identifier hs-type">server</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Network.Ouroboros.Server.html#FireForgetServer"><span class="hs-identifier hs-type">FireForgetServer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680175086"><span class="hs-identifier hs-type">msg</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>  </span><span id="local-6989586621680175713"><span class="annot"><span class="annottext">server :: FireForgetServer msg IO ()
</span><a href="#local-6989586621680175713"><span class="hs-identifier hs-var hs-var">server</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-276"></span><span>    </span><span class="annot"><a href="Hydra.Network.Ouroboros.Server.html#FireForgetServer"><span class="hs-identifier hs-type">FireForgetServer</span></a></span><span>
</span><span id="line-277"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">recvMsg :: msg -&gt; IO (FireForgetServer msg IO ())
</span><a href="Hydra.Network.Ouroboros.Server.html#recvMsg"><span class="hs-identifier hs-var">recvMsg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680175723"><span class="annot"><span class="annottext">msg
</span><a href="#local-6989586621680175723"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NetworkCallback msg IO
</span><a href="#local-6989586621680175560"><span class="hs-identifier hs-var">networkCallback</span></a></span><span> </span><span class="annot"><span class="annottext">msg
</span><a href="#local-6989586621680175723"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
-&gt; FireForgetServer msg IO () -&gt; IO (FireForgetServer msg IO ())
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%24%3E"><span class="hs-operator hs-var">$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FireForgetServer msg IO ()
</span><a href="#local-6989586621680175713"><span class="hs-identifier hs-var">server</span></a></span><span>
</span><span id="line-278"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recvMsgDone :: IO ()
</span><a href="Hydra.Network.Ouroboros.Server.html#recvMsgDone"><span class="hs-identifier hs-var">recvMsgDone</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span class="hs-keyword">data</span><span> </span><span id="NetworkServerListenException"><span class="annot"><a href="Hydra.Network.Ouroboros.html#NetworkServerListenException"><span class="hs-identifier hs-var">NetworkServerListenException</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="NetworkServerListenException"><span class="annot"><a href="Hydra.Network.Ouroboros.html#NetworkServerListenException"><span class="hs-identifier hs-var">NetworkServerListenException</span></a></span></span><span>
</span><span id="line-282"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="ioException"><span class="annot"><span class="annottext">NetworkServerListenException -&gt; IOException
</span><a href="Hydra.Network.Ouroboros.html#ioException"><span class="hs-identifier hs-var hs-var">ioException</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.IO.Exception.html#IOException"><span class="hs-identifier hs-type">IOException</span></a></span><span>
</span><span id="line-283"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="localHost"><span class="annot"><span class="annottext">NetworkServerListenException -&gt; Host
</span><a href="Hydra.Network.Ouroboros.html#localHost"><span class="hs-identifier hs-var hs-var">localHost</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Network.html#Host"><span class="hs-identifier hs-type">Host</span></a></span><span>
</span><span id="line-284"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680175727"><span id="local-6989586621680175735"><span id="local-6989586621680175739"><span class="annot"><span class="annottext">Int -&gt; NetworkServerListenException -&gt; ShowS
[NetworkServerListenException] -&gt; ShowS
NetworkServerListenException -&gt; ServiceName
(Int -&gt; NetworkServerListenException -&gt; ShowS)
-&gt; (NetworkServerListenException -&gt; ServiceName)
-&gt; ([NetworkServerListenException] -&gt; ShowS)
-&gt; Show NetworkServerListenException
forall a.
(Int -&gt; a -&gt; ShowS)
-&gt; (a -&gt; ServiceName) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; NetworkServerListenException -&gt; ShowS
showsPrec :: Int -&gt; NetworkServerListenException -&gt; ShowS
$cshow :: NetworkServerListenException -&gt; ServiceName
show :: NetworkServerListenException -&gt; ServiceName
$cshowList :: [NetworkServerListenException] -&gt; ShowS
showList :: [NetworkServerListenException] -&gt; ShowS
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680175747"><span id="local-6989586621680175750"><span id="local-6989586621680175753"><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Exception.Type.html#Exception"><span class="hs-identifier hs-type">Exception</span></a></span><span> </span><span class="annot"><a href="Hydra.Network.Ouroboros.html#NetworkServerListenException"><span class="hs-identifier hs-type">NetworkServerListenException</span></a></span></span></span></span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span class="hs-keyword">data</span><span> </span><span id="WithHost"><span class="annot"><a href="Hydra.Network.Ouroboros.html#WithHost"><span class="hs-identifier hs-var">WithHost</span></a></span></span><span> </span><span id="local-6989586621680175170"><span class="annot"><a href="#local-6989586621680175170"><span class="hs-identifier hs-type">trace</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WithHost"><span class="annot"><a href="Hydra.Network.Ouroboros.html#WithHost"><span class="hs-identifier hs-var">WithHost</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Network.html#Host"><span class="hs-identifier hs-type">Host</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680175170"><span class="hs-identifier hs-type">trace</span></a></span><span>
</span><span id="line-290"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680175758"><span id="local-6989586621680175763"><span id="local-6989586621680175767"><span class="annot"><span class="annottext">Int -&gt; WithHost trace -&gt; ShowS
[WithHost trace] -&gt; ShowS
WithHost trace -&gt; ServiceName
(Int -&gt; WithHost trace -&gt; ShowS)
-&gt; (WithHost trace -&gt; ServiceName)
-&gt; ([WithHost trace] -&gt; ShowS)
-&gt; Show (WithHost trace)
forall trace. Show trace =&gt; Int -&gt; WithHost trace -&gt; ShowS
forall trace. Show trace =&gt; [WithHost trace] -&gt; ShowS
forall trace. Show trace =&gt; WithHost trace -&gt; ServiceName
forall a.
(Int -&gt; a -&gt; ShowS)
-&gt; (a -&gt; ServiceName) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall trace. Show trace =&gt; Int -&gt; WithHost trace -&gt; ShowS
showsPrec :: Int -&gt; WithHost trace -&gt; ShowS
$cshow :: forall trace. Show trace =&gt; WithHost trace -&gt; ServiceName
show :: WithHost trace -&gt; ServiceName
$cshowList :: forall trace. Show trace =&gt; [WithHost trace] -&gt; ShowS
showList :: [WithHost trace] -&gt; ShowS
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680175324"><span id="local-6989586621680175772"><span id="local-6989586621680175776"><span id="local-6989586621680175779"><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621680175324"><span class="hs-identifier hs-type">trace</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Network.Ouroboros.html#WithHost"><span class="hs-identifier hs-type">WithHost</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680175324"><span class="hs-identifier hs-type">trace</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-293"></span><span>  </span><span id="local-6989586621680175789"><span class="annot"><span class="annottext">toJSON :: WithHost trace -&gt; Value
</span><a href="#local-6989586621680175789"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Network.Ouroboros.html#WithHost"><span class="hs-identifier hs-type">WithHost</span></a></span><span> </span><span id="local-6989586621680175791"><span class="annot"><span class="annottext">Host
</span><a href="#local-6989586621680175791"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621680175792"><span class="annot"><span class="annottext">trace
</span><a href="#local-6989586621680175792"><span class="hs-identifier hs-var">tr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-294"></span><span>    </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">object</span></span><span>
</span><span id="line-295"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;host&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Host -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">Host
</span><a href="#local-6989586621680175791"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-296"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;data&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; trace -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">trace
</span><a href="#local-6989586621680175792"><span class="hs-identifier hs-var">tr</span></a></span><span>
</span><span id="line-297"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680175331"><span id="local-6989586621680175796"><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621680175331"><span class="hs-identifier hs-type">trace</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Network.Ouroboros.html#WithHost"><span class="hs-identifier hs-type">WithHost</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680175331"><span class="hs-identifier hs-type">trace</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-300"></span><span>  </span><span id="local-6989586621680175809"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser (WithHost trace)
</span><a href="#local-6989586621680175809"><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServiceName
-&gt; (Object -&gt; Parser (WithHost trace))
-&gt; Value
-&gt; Parser (WithHost trace)
forall a. ServiceName -&gt; (Object -&gt; Parser a) -&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">withObject</span></span><span> </span><span class="annot"><span class="annottext">ServiceName
</span><span class="hs-string">&quot;WithHost&quot;</span></span><span> </span><span class="annot"><span class="annottext">((Object -&gt; Parser (WithHost trace))
 -&gt; Value -&gt; Parser (WithHost trace))
-&gt; (Object -&gt; Parser (WithHost trace))
-&gt; Value
-&gt; Parser (WithHost trace)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680175811"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621680175811"><span class="hs-identifier hs-var">obj</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-301"></span><span>    </span><span class="annot"><span class="annottext">Host -&gt; trace -&gt; WithHost trace
forall trace. Host -&gt; trace -&gt; WithHost trace
</span><a href="Hydra.Network.Ouroboros.html#WithHost"><span class="hs-identifier hs-var">WithHost</span></a></span><span>
</span><span id="line-302"></span><span>      </span><span class="annot"><span class="annottext">(Host -&gt; trace -&gt; WithHost trace)
-&gt; Parser Host -&gt; Parser (trace -&gt; WithHost trace)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621680175811"><span class="hs-identifier hs-var">obj</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser Host
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;host&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>      </span><span class="annot"><span class="annottext">Parser (trace -&gt; WithHost trace)
-&gt; Parser trace -&gt; Parser (WithHost trace)
forall a b. Parser (a -&gt; b) -&gt; Parser a -&gt; Parser b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621680175811"><span class="hs-identifier hs-var">obj</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser trace
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;data&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span class="hs-keyword">data</span><span> </span><span id="TraceOuroborosNetwork"><span class="annot"><a href="Hydra.Network.Ouroboros.html#TraceOuroborosNetwork"><span class="hs-identifier hs-var">TraceOuroborosNetwork</span></a></span></span><span> </span><span id="local-6989586621680175172"><span class="annot"><a href="#local-6989586621680175172"><span class="hs-identifier hs-type">msg</span></a></span></span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="TraceSubscriptions"><span class="annot"><a href="Hydra.Network.Ouroboros.html#TraceSubscriptions"><span class="hs-identifier hs-var">TraceSubscriptions</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WithIPList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SubscriptionTrace</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SockAddr</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TraceErrorPolicy"><span class="annot"><a href="Hydra.Network.Ouroboros.html#TraceErrorPolicy"><span class="hs-identifier hs-var">TraceErrorPolicy</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WithAddr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SockAddr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ErrorPolicyTrace</span></span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TraceAcceptPolicy"><span class="annot"><a href="Hydra.Network.Ouroboros.html#TraceAcceptPolicy"><span class="hs-identifier hs-var">TraceAcceptPolicy</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">AcceptConnectionsPolicyTrace</span></span><span>
</span><span id="line-309"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TraceHandshake"><span class="annot"><a href="Hydra.Network.Ouroboros.html#TraceHandshake"><span class="hs-identifier hs-var">TraceHandshake</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WithMuxBearer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SockAddr</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TraceSendRecv</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Handshake</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UnversionedProtocol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Term</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TraceSendRecv"><span class="annot"><a href="Hydra.Network.Ouroboros.html#TraceSendRecv"><span class="hs-identifier hs-var">TraceSendRecv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TraceSendRecv</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Network.Ouroboros.Type.html#FireForget"><span class="hs-identifier hs-type">FireForget</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680175172"><span class="hs-identifier hs-type">msg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span class="hs-comment">-- NOTE: cardano-node would have orphan ToObject instances for most of these</span><span>
</span><span id="line-313"></span><span class="hs-comment">-- types, but we want to avoid that dependency.</span><span>
</span><span id="line-314"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680175341"><span id="local-6989586621680175818"><span id="local-6989586621680175822"><span id="local-6989586621680175825"><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621680175341"><span class="hs-identifier hs-type">msg</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Network.Ouroboros.html#TraceOuroborosNetwork"><span class="hs-identifier hs-type">TraceOuroborosNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680175341"><span class="hs-identifier hs-type">msg</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-315"></span><span>  </span><span id="local-6989586621680175857"><span class="annot"><span class="annottext">toJSON :: TraceOuroborosNetwork msg -&gt; Value
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-316"></span><span>    </span><span class="annot"><a href="Hydra.Network.Ouroboros.html#TraceSubscriptions"><span class="hs-identifier hs-type">TraceSubscriptions</span></a></span><span> </span><span id="local-6989586621680175858"><span class="annot"><span class="annottext">WithIPList (SubscriptionTrace SockAddr)
</span><a href="#local-6989586621680175858"><span class="hs-identifier hs-var">withIpList</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-317"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; [Pair] -&gt; Value
</span><a href="Hydra.Network.Ouroboros.html#tagged"><span class="hs-identifier hs-var">tagged</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;TraceSubscriptions&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;subscriptions&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Value -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">WithIPList (SubscriptionTrace SockAddr) -&gt; Value
</span><a href="Hydra.Network.Ouroboros.html#encodeWithIPList"><span class="hs-identifier hs-var">encodeWithIPList</span></a></span><span> </span><span class="annot"><span class="annottext">WithIPList (SubscriptionTrace SockAddr)
</span><a href="#local-6989586621680175858"><span class="hs-identifier hs-var">withIpList</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-318"></span><span>    </span><span class="annot"><a href="Hydra.Network.Ouroboros.html#TraceErrorPolicy"><span class="hs-identifier hs-type">TraceErrorPolicy</span></a></span><span> </span><span id="local-6989586621680175861"><span class="annot"><span class="annottext">WithAddr SockAddr ErrorPolicyTrace
</span><a href="#local-6989586621680175861"><span class="hs-identifier hs-var">withAddr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-319"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; [Pair] -&gt; Value
</span><a href="Hydra.Network.Ouroboros.html#tagged"><span class="hs-identifier hs-var">tagged</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;TraceErrorPolicy&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;errors&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Value -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">WithAddr SockAddr ErrorPolicyTrace -&gt; Value
</span><a href="Hydra.Network.Ouroboros.html#encodeWithAddr"><span class="hs-identifier hs-var">encodeWithAddr</span></a></span><span> </span><span class="annot"><span class="annottext">WithAddr SockAddr ErrorPolicyTrace
</span><a href="#local-6989586621680175861"><span class="hs-identifier hs-var">withAddr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-320"></span><span>    </span><span class="annot"><a href="Hydra.Network.Ouroboros.html#TraceAcceptPolicy"><span class="hs-identifier hs-type">TraceAcceptPolicy</span></a></span><span> </span><span id="local-6989586621680175863"><span class="annot"><span class="annottext">AcceptConnectionsPolicyTrace
</span><a href="#local-6989586621680175863"><span class="hs-identifier hs-var">accept</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-321"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; [Pair] -&gt; Value
</span><a href="Hydra.Network.Ouroboros.html#tagged"><span class="hs-identifier hs-var">tagged</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;TraceAcceptPolicy&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;accept&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="annottext">AcceptConnectionsPolicyTrace
</span><a href="#local-6989586621680175863"><span class="hs-identifier hs-var">accept</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-322"></span><span>    </span><span class="annot"><a href="Hydra.Network.Ouroboros.html#TraceHandshake"><span class="hs-identifier hs-type">TraceHandshake</span></a></span><span> </span><span id="local-6989586621680175864"><span class="annot"><span class="annottext">WithMuxBearer
  (ConnectionId SockAddr)
  (TraceSendRecv (Handshake UnversionedProtocol Term))
</span><a href="#local-6989586621680175864"><span class="hs-identifier hs-var">handshake</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-323"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; [Pair] -&gt; Value
</span><a href="Hydra.Network.Ouroboros.html#tagged"><span class="hs-identifier hs-var">tagged</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;TraceHandshake&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;handshake&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; [Pair] -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">WithMuxBearer
  (ConnectionId SockAddr)
  (TraceSendRecv (Handshake UnversionedProtocol Term))
-&gt; [Pair]
</span><a href="Hydra.Network.Ouroboros.html#encodeTraceSendRecvHandshake"><span class="hs-identifier hs-var">encodeTraceSendRecvHandshake</span></a></span><span> </span><span class="annot"><span class="annottext">WithMuxBearer
  (ConnectionId SockAddr)
  (TraceSendRecv (Handshake UnversionedProtocol Term))
</span><a href="#local-6989586621680175864"><span class="hs-identifier hs-var">handshake</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-324"></span><span>    </span><span class="annot"><a href="Hydra.Network.Ouroboros.html#TraceSendRecv"><span class="hs-identifier hs-type">TraceSendRecv</span></a></span><span> </span><span id="local-6989586621680175866"><span class="annot"><span class="annottext">TraceSendRecv (FireForget msg)
</span><a href="#local-6989586621680175866"><span class="hs-identifier hs-var">sndRcv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-325"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; [Pair] -&gt; Value
</span><a href="Hydra.Network.Ouroboros.html#tagged"><span class="hs-identifier hs-var">tagged</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;TraceSendRecv&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;trace&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; [Pair] -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">TraceSendRecv (FireForget msg) -&gt; [Pair]
forall msg. ToJSON msg =&gt; TraceSendRecv (FireForget msg) -&gt; [Pair]
</span><a href="Hydra.Network.Ouroboros.html#encodeTraceSendRecvFireForget"><span class="hs-identifier hs-var">encodeTraceSendRecvFireForget</span></a></span><span> </span><span class="annot"><span class="annottext">TraceSendRecv (FireForget msg)
</span><a href="#local-6989586621680175866"><span class="hs-identifier hs-var">sndRcv</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span class="annot"><a href="Hydra.Network.Ouroboros.html#tagged"><span class="hs-identifier hs-type">tagged</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Aeson.Pair</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Aeson.Value</span></span><span>
</span><span id="line-328"></span><span id="tagged"><span class="annot"><span class="annottext">tagged :: Text -&gt; [Pair] -&gt; Value
</span><a href="Hydra.Network.Ouroboros.html#tagged"><span class="hs-identifier hs-var hs-var">tagged</span></a></span></span><span> </span><span id="local-6989586621680175867"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680175867"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span id="local-6989586621680175868"><span class="annot"><span class="annottext">[Pair]
</span><a href="#local-6989586621680175868"><span class="hs-identifier hs-var">pairs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">object</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;tag&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680175867"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Pair -&gt; [Pair] -&gt; [Pair]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Pair]
</span><a href="#local-6989586621680175868"><span class="hs-identifier hs-var">pairs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span class="annot"><a href="Hydra.Network.Ouroboros.html#encodeWithIPList"><span class="hs-identifier hs-type">encodeWithIPList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WithIPList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SubscriptionTrace</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SockAddr</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Aeson.Value</span></span><span>
</span><span id="line-331"></span><span id="encodeWithIPList"><span class="annot"><span class="annottext">encodeWithIPList :: WithIPList (SubscriptionTrace SockAddr) -&gt; Value
</span><a href="Hydra.Network.Ouroboros.html#encodeWithIPList"><span class="hs-identifier hs-var hs-var">encodeWithIPList</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WithIPList</span></span><span> </span><span id="local-6989586621680175869"><span class="annot"><span class="annottext">LocalAddresses SockAddr
</span><a href="#local-6989586621680175869"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621680175870"><span class="annot"><span class="annottext">[SockAddr]
</span><a href="#local-6989586621680175870"><span class="hs-identifier hs-var">dsts</span></a></span></span><span> </span><span id="local-6989586621680175871"><span class="annot"><span class="annottext">SubscriptionTrace SockAddr
</span><a href="#local-6989586621680175871"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-332"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; [Pair] -&gt; Value
</span><a href="Hydra.Network.Ouroboros.html#tagged"><span class="hs-identifier hs-var">tagged</span></a></span><span>
</span><span id="line-333"></span><span>    </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;WithIPList&quot;</span></span><span>
</span><span id="line-334"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;src&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="annottext">LocalAddresses SockAddr
</span><a href="#local-6989586621680175869"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-335"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;dsts&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="annottext">[SockAddr]
</span><a href="#local-6989586621680175870"><span class="hs-identifier hs-var">dsts</span></a></span><span>
</span><span id="line-336"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;event&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="annottext">SubscriptionTrace SockAddr
</span><a href="#local-6989586621680175871"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-337"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span class="annot"><a href="Hydra.Network.Ouroboros.html#encodeWithAddr"><span class="hs-identifier hs-type">encodeWithAddr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WithAddr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SockAddr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ErrorPolicyTrace</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Aeson.Value</span></span><span>
</span><span id="line-340"></span><span id="encodeWithAddr"><span class="annot"><span class="annottext">encodeWithAddr :: WithAddr SockAddr ErrorPolicyTrace -&gt; Value
</span><a href="Hydra.Network.Ouroboros.html#encodeWithAddr"><span class="hs-identifier hs-var hs-var">encodeWithAddr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WithAddr</span></span><span> </span><span id="local-6989586621680175872"><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621680175872"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621680175873"><span class="annot"><span class="annottext">ErrorPolicyTrace
</span><a href="#local-6989586621680175873"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-341"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; [Pair] -&gt; Value
</span><a href="Hydra.Network.Ouroboros.html#tagged"><span class="hs-identifier hs-var">tagged</span></a></span><span>
</span><span id="line-342"></span><span>    </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;WithAddr&quot;</span></span><span>
</span><span id="line-343"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;addr&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621680175872"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-344"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;event&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorPolicyTrace
</span><a href="#local-6989586621680175873"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span class="annot"><a href="Hydra.Network.Ouroboros.html#encodeTraceSendRecvHandshake"><span class="hs-identifier hs-type">encodeTraceSendRecvHandshake</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-348"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">WithMuxBearer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConnectionId</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SockAddr</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TraceSendRecv</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Handshake</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UnversionedProtocol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Term</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-349"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Aeson.Pair</span></span><span class="hs-special">]</span><span>
</span><span id="line-350"></span><span id="encodeTraceSendRecvHandshake"><span class="annot"><span class="annottext">encodeTraceSendRecvHandshake :: WithMuxBearer
  (ConnectionId SockAddr)
  (TraceSendRecv (Handshake UnversionedProtocol Term))
-&gt; [Pair]
</span><a href="Hydra.Network.Ouroboros.html#encodeTraceSendRecvHandshake"><span class="hs-identifier hs-var hs-var">encodeTraceSendRecvHandshake</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-351"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">WithMuxBearer</span></span><span> </span><span id="local-6989586621680175875"><span class="annot"><span class="annottext">ConnectionId SockAddr
</span><a href="#local-6989586621680175875"><span class="hs-identifier hs-var">peerId</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TraceSendMsg</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AnyMessageAndAgency</span></span><span> </span><span id="local-6989586621680175897"><span class="annot"><span class="annottext">PeerHasAgency pr st
</span><a href="#local-6989586621680175897"><span class="hs-identifier hs-var">agency</span></a></span></span><span> </span><span id="local-6989586621680175898"><span class="annot"><span class="annottext">Message (Handshake UnversionedProtocol Term) st st'
</span><a href="#local-6989586621680175898"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-352"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;event&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; ServiceName -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServiceName
</span><span class="hs-string">&quot;send&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-353"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;agency&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerHasAgency pr st -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">PeerHasAgency pr st
</span><a href="#local-6989586621680175897"><span class="hs-identifier hs-var">agency</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;peer&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConnectionId SockAddr -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ConnectionId SockAddr
</span><a href="#local-6989586621680175875"><span class="hs-identifier hs-var">peerId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-356"></span><span>      </span><span class="annot"><span class="annottext">[Pair] -&gt; [Pair] -&gt; [Pair]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Message (Handshake UnversionedProtocol Term) st st' -&gt; [Pair]
forall (from :: Handshake UnversionedProtocol Term)
       (to :: Handshake UnversionedProtocol Term).
Message (Handshake UnversionedProtocol Term) from to -&gt; [Pair]
</span><a href="#local-6989586621680175899"><span class="hs-identifier hs-var">encodeMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Message (Handshake UnversionedProtocol Term) st st'
</span><a href="#local-6989586621680175898"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-357"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">WithMuxBearer</span></span><span> </span><span id="local-6989586621680175900"><span class="annot"><span class="annottext">ConnectionId SockAddr
</span><a href="#local-6989586621680175900"><span class="hs-identifier hs-var">peerId</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TraceRecvMsg</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AnyMessageAndAgency</span></span><span> </span><span id="local-6989586621680175918"><span class="annot"><span class="annottext">PeerHasAgency pr st
</span><a href="#local-6989586621680175918"><span class="hs-identifier hs-var">agency</span></a></span></span><span> </span><span id="local-6989586621680175919"><span class="annot"><span class="annottext">Message (Handshake UnversionedProtocol Term) st st'
</span><a href="#local-6989586621680175919"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-358"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;event&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;receive&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;agency&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerHasAgency pr st -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">PeerHasAgency pr st
</span><a href="#local-6989586621680175918"><span class="hs-identifier hs-var">agency</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;peer&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConnectionId SockAddr -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ConnectionId SockAddr
</span><a href="#local-6989586621680175900"><span class="hs-identifier hs-var">peerId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-362"></span><span>      </span><span class="annot"><span class="annottext">[Pair] -&gt; [Pair] -&gt; [Pair]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Message (Handshake UnversionedProtocol Term) st st' -&gt; [Pair]
forall (from :: Handshake UnversionedProtocol Term)
       (to :: Handshake UnversionedProtocol Term).
Message (Handshake UnversionedProtocol Term) from to -&gt; [Pair]
</span><a href="#local-6989586621680175899"><span class="hs-identifier hs-var">encodeMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Message (Handshake UnversionedProtocol Term) st st'
</span><a href="#local-6989586621680175919"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-363"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-364"></span><span>  </span><span id="local-6989586621680175359"><span id="local-6989586621680175360"><span class="annot"><a href="#local-6989586621680175899"><span class="hs-identifier hs-type">encodeMsg</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-365"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Handshake</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UnversionedProtocol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680175359"><span class="hs-identifier hs-type">from</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680175360"><span class="hs-identifier hs-type">to</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-366"></span><span>    </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Aeson.Pair</span></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-367"></span><span>  </span><span id="local-6989586621680175899"><span class="annot"><span class="annottext">encodeMsg :: forall (from :: Handshake UnversionedProtocol Term)
       (to :: Handshake UnversionedProtocol Term).
Message (Handshake UnversionedProtocol Term) from to -&gt; [Pair]
</span><a href="#local-6989586621680175899"><span class="hs-identifier hs-var hs-var">encodeMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-368"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MsgProposeVersions</span></span><span> </span><span id="local-6989586621680175940"><span class="annot"><span class="annottext">Map vNumber1 vParams1
</span><a href="#local-6989586621680175940"><span class="hs-identifier hs-var">versions</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-369"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;tag&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; ServiceName -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServiceName
</span><span class="hs-string">&quot;ProposeVersions&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;versions&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; [Text] -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">vNumber1 -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(vNumber1 -&gt; Text) -&gt; [vNumber1] -&gt; [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map vNumber1 vParams1 -&gt; [vNumber1]
forall k a. Map k a -&gt; [k]
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keys"><span class="hs-identifier hs-var">Map.keys</span></a></span><span> </span><span class="annot"><span class="annottext">Map vNumber1 vParams1
</span><a href="#local-6989586621680175940"><span class="hs-identifier hs-var">versions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-372"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MsgAcceptVersion</span></span><span> </span><span id="local-6989586621680175960"><span class="annot"><span class="annottext">vNumber1
</span><a href="#local-6989586621680175960"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">vParams1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-373"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;tag&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; ServiceName -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServiceName
</span><span class="hs-string">&quot;AcceptVersion&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;version&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">vNumber1 -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">vNumber1
</span><a href="#local-6989586621680175960"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-376"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MsgRefuse</span></span><span> </span><span id="local-6989586621680175973"><span class="annot"><span class="annottext">RefuseReason vNumber1
</span><a href="#local-6989586621680175973"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-377"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;tag&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; ServiceName -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServiceName
</span><span class="hs-string">&quot;RefuseVersions&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;reason&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Value -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">RefuseReason vNumber1 -&gt; Value
forall vNumber. RefuseReason vNumber -&gt; Value
</span><a href="#local-6989586621680175974"><span class="hs-identifier hs-var">encodeRefuseReason</span></a></span><span> </span><span class="annot"><span class="annottext">RefuseReason vNumber1
</span><a href="#local-6989586621680175973"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-379"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-380"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MsgReplyVersions</span></span><span> </span><span id="local-6989586621680175994"><span class="annot"><span class="annottext">Map vNumber1 vParams1
</span><a href="#local-6989586621680175994"><span class="hs-identifier hs-var">versions</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-381"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;tag&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; ServiceName -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServiceName
</span><span class="hs-string">&quot;ReplyVersions&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;versions&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; [Text] -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">vNumber1 -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(vNumber1 -&gt; Text) -&gt; [vNumber1] -&gt; [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map vNumber1 vParams1 -&gt; [vNumber1]
forall k a. Map k a -&gt; [k]
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keys"><span class="hs-identifier hs-var">Map.keys</span></a></span><span> </span><span class="annot"><span class="annottext">Map vNumber1 vParams1
</span><a href="#local-6989586621680175994"><span class="hs-identifier hs-var">versions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-384"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MsgQueryReply</span></span><span> </span><span id="local-6989586621680176014"><span class="annot"><span class="annottext">Map vNumber1 vParams1
</span><a href="#local-6989586621680176014"><span class="hs-identifier hs-var">versions</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-385"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;tag&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; ServiceName -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServiceName
</span><span class="hs-string">&quot;MsgQueryReply&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;versions&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; [Text] -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">vNumber1 -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(vNumber1 -&gt; Text) -&gt; [vNumber1] -&gt; [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map vNumber1 vParams1 -&gt; [vNumber1]
forall k a. Map k a -&gt; [k]
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keys"><span class="hs-identifier hs-var">Map.keys</span></a></span><span> </span><span class="annot"><span class="annottext">Map vNumber1 vParams1
</span><a href="#local-6989586621680176014"><span class="hs-identifier hs-var">versions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span>  </span><span id="local-6989586621680175379"><span class="annot"><a href="#local-6989586621680175974"><span class="hs-identifier hs-type">encodeRefuseReason</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-390"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">RefuseReason</span></span><span> </span><span class="annot"><a href="#local-6989586621680175379"><span class="hs-identifier hs-type">vNumber</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-391"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Aeson.Value</span></span></span><span>
</span><span id="line-392"></span><span>  </span><span id="local-6989586621680175974"><span class="annot"><span class="annottext">encodeRefuseReason :: forall vNumber. RefuseReason vNumber -&gt; Value
</span><a href="#local-6989586621680175974"><span class="hs-identifier hs-var hs-var">encodeRefuseReason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-393"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">VersionMismatch</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><span class="hs-identifier hs-var">Aeson.String</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;VersionMismatchOrUnknown&quot;</span></span><span>
</span><span id="line-394"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">HandshakeDecodeError</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><span class="hs-identifier hs-var">Aeson.String</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;HandshakeDecodeError&quot;</span></span><span>
</span><span id="line-395"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Refused</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><span class="hs-identifier hs-var">Aeson.String</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ServerRejected&quot;</span></span><span>
</span><span id="line-396"></span><span>
</span><span id="line-397"></span><span class="annot"><a href="Hydra.Network.Ouroboros.html#encodeTraceSendRecvFireForget"><span class="hs-identifier hs-type">encodeTraceSendRecvFireForget</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-398"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680175345"><span class="annot"><a href="#local-6989586621680175345"><span class="hs-identifier hs-type">msg</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-399"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621680175345"><span class="hs-identifier hs-type">msg</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-400"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TraceSendRecv</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Network.Ouroboros.Type.html#FireForget"><span class="hs-identifier hs-type">FireForget</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680175345"><span class="hs-identifier hs-type">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-401"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Aeson.Pair</span></span><span class="hs-special">]</span><span>
</span><span id="line-402"></span><span id="encodeTraceSendRecvFireForget"><span class="annot"><span class="annottext">encodeTraceSendRecvFireForget :: forall msg. ToJSON msg =&gt; TraceSendRecv (FireForget msg) -&gt; [Pair]
</span><a href="Hydra.Network.Ouroboros.html#encodeTraceSendRecvFireForget"><span class="hs-identifier hs-var hs-var">encodeTraceSendRecvFireForget</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-403"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TraceSendMsg</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AnyMessageAndAgency</span></span><span> </span><span id="local-6989586621680176034"><span class="annot"><span class="annottext">PeerHasAgency pr st
</span><a href="#local-6989586621680176034"><span class="hs-identifier hs-var">agency</span></a></span></span><span> </span><span id="local-6989586621680176035"><span class="annot"><span class="annottext">Message (FireForget msg) st st'
</span><a href="#local-6989586621680176035"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-404"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;event&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; ServiceName -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServiceName
</span><span class="hs-string">&quot;send&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;agency&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerHasAgency pr st -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">PeerHasAgency pr st
</span><a href="#local-6989586621680176034"><span class="hs-identifier hs-var">agency</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-407"></span><span>      </span><span class="annot"><span class="annottext">[Pair] -&gt; [Pair] -&gt; [Pair]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Message (FireForget msg) st st' -&gt; [Pair]
forall (from :: FireForget msg) (to :: FireForget msg).
Message (FireForget msg) from to -&gt; [Pair]
</span><a href="#local-6989586621680176036"><span class="hs-identifier hs-var">encodeMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Message (FireForget msg) st st'
</span><a href="#local-6989586621680176035"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-408"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TraceRecvMsg</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AnyMessageAndAgency</span></span><span> </span><span id="local-6989586621680176048"><span class="annot"><span class="annottext">PeerHasAgency pr st
</span><a href="#local-6989586621680176048"><span class="hs-identifier hs-var">agency</span></a></span></span><span> </span><span id="local-6989586621680176049"><span class="annot"><span class="annottext">Message (FireForget msg) st st'
</span><a href="#local-6989586621680176049"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-409"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;event&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;receive&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;agency&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerHasAgency pr st -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">PeerHasAgency pr st
</span><a href="#local-6989586621680176048"><span class="hs-identifier hs-var">agency</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-411"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-412"></span><span>      </span><span class="annot"><span class="annottext">[Pair] -&gt; [Pair] -&gt; [Pair]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/g8kpsqnlf06y5x8pppcj6c4hcjavb5jq-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Message (FireForget msg) st st' -&gt; [Pair]
forall (from :: FireForget msg) (to :: FireForget msg).
Message (FireForget msg) from to -&gt; [Pair]
</span><a href="#local-6989586621680176036"><span class="hs-identifier hs-var">encodeMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Message (FireForget msg) st st'
</span><a href="#local-6989586621680176049"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-413"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-414"></span><span>  </span><span id="local-6989586621680175389"><span id="local-6989586621680175390"><span class="annot"><a href="#local-6989586621680176036"><span class="hs-identifier hs-type">encodeMsg</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-415"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Network.Ouroboros.Type.html#FireForget"><span class="hs-identifier hs-type">FireForget</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680175345"><span class="hs-identifier hs-type">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680175389"><span class="hs-identifier hs-type">from</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680175390"><span class="hs-identifier hs-type">to</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-416"></span><span>    </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Aeson.Pair</span></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-417"></span><span>  </span><span id="local-6989586621680176036"><span class="annot"><span class="annottext">encodeMsg :: forall (from :: FireForget msg) (to :: FireForget msg).
Message (FireForget msg) from to -&gt; [Pair]
</span><a href="#local-6989586621680176036"><span class="hs-identifier hs-var hs-var">encodeMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-418"></span><span>    </span><span class="annot"><a href="Hydra.Network.Ouroboros.Type.html#MsgSend"><span class="hs-identifier hs-type">MsgSend</span></a></span><span> </span><span id="local-6989586621680176059"><span class="annot"><span class="annottext">msg1
</span><a href="#local-6989586621680176059"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-419"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;send&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; msg1 -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">msg1
</span><a href="#local-6989586621680176059"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-420"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-421"></span><span>    </span><span class="annot"><span class="annottext">Message (FireForget msg) from to
R:MessageFireForgetfromto (*) msg from to
</span><a href="Hydra.Network.Ouroboros.Type.html#MsgDone"><span class="hs-identifier hs-var">MsgDone</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-422"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;done&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; () -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-424"></span></pre></body></html>